<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Ian Wootten - Web Developer, Cardiff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/fonts/open-sans.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-263865-2', 'ianwootten.co.uk');
      ga('send', 'pageview');

    </script>
</head>
<body>

<div class="container blog">
      <header>
        <nav>
        <ul class="nav">
          <li><a class="blog active" href="/">Blog</a></li>
          <li><a class="javascript" href="/category/javascript">Javascript</a></li>
          <li><a class="web-apps" href="/category/web-apps">Web Apps</a></li>
          <li><a class="about" href="/about">About</a></li>
          <li><a class="contact" href="/contact">Contact</a></li>
        </ul>
        </nav>
        <div class="clear"></div>
      </header>

      <div class="post">
        <h1><a href="/2014/03/07/scaling-a-linear-domain-to-an-ordinal-range-with-d3">Scaling a Linear Domain to an Ordinal Range with d3</a></h1>
        <div class="author_meta">07 Mar 2014</div>
        <p>I&#8217;ve had the opportunity of using <a href="http://d3js.org/">d3</a> quite a lot over the past few months for a number of clients. It offers some amazing flexibility for chart generation and much more.</p>
<p>Anyway, I thought I&#8217;d share a quick tip I developed for mapping a linear set of values onto an ordinal scale. For those who&#8217;re seasoned pros at d3, this probably seems trivial, but had me stumped for some time today.</p>
<p>I&#8217;d picked out a colour palette I wanted to use for a particular graph, as per below:</p>
<div class='hljs'><pre><code class='javascript'><span class="hljs-keyword">var</span> colours = [<span class="hljs-string">"#B8D0DE"</span>, <span class="hljs-string">"#9FC2D6"</span>, <span class="hljs-string">"#86B4CF"</span>, <span class="hljs-string">"#73A2BD"</span>, <span class="hljs-string">"#6792AB"</span>];</code></pre></div><p>The only examples I&#8217;ve seen similar to this are where it is assumed you want to vary darkness of colours based on value or <a href="http://stackoverflow.com/questions/17321139/mapping-in-d3-ordinal-scales">vary the domain</a> based on the number of colours you want. Not a good fit.</p>
<p>I wanted to pick one of my values based on a linear value from my data set. My first thought was to make use of the ordinal scale function provided by d3. Something like this:</p>
<div class='hljs'><pre><code class='javascript'><span class="hljs-keyword">var</span> colour = d3.scale.ordinal()
  .domain(mySortedDataValues)
  .range(colours);</code></pre></div><p>In doing this, I got something that *looked* a bit like it was working, but not the way I expected. In fact, the way an ordinal scale works is that it provides a 1-to-1 mapping of domain values to the range, rather than any kind of interpolation between them. In this case, it was expecting only 5 distinct data values (to match up against the colours) and for everything over and above that, it wrapped them round to the beginning of the domain again. The solution then is fairly simple once you&#8217;ve got your head around that.</p>
<p>What I did next, was to create a scale that gave the index of the colour we were going to be mapping to. This works well, because the indices are linear and d3 has the ability to do the dirty work in that respect.</p>
<div class='hljs'><pre><code class='javascript'><span class="hljs-keyword">var</span> colourIndex = d3.scale.linear()
  .domain([<span class="hljs-number">0</span>, d3.max(data)])
  .range([<span class="hljs-number">0</span>, colours.length - <span class="hljs-number">1</span>]);

svg.selectAll(<span class="hljs-string">"circle"</span>)
  .data(data)
  .enter()
  .append(<span class="hljs-string">"circle"</span>)
  .attr(<span class="hljs-string">"fill"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>)</span>{
    <span class="hljs-keyword">return</span> colours[<span class="hljs-built_in">Math</span>.ceil(colourIndex(d))];
   });</code></pre></div><p>Here we end up with an index ranging across all the indices of the colour array, and a colour appropriately selected from the palette as expected. You can see the resultant effect in the graph linked to below:</p>
<p><blockquote class="twitter-tweet" lang="en"><p>Working on some funky graphs for <a href="https://twitter.com/UseHourglass">@usehourglass</a>. This one shows how often you work certain times of the week: <a href="http://t.co/xRHE39HmTu">pic.twitter.com/xRHE39HmTu</a></p>&mdash; Ian Wootten (@iwootten) <a href="https://twitter.com/iwootten/statuses/441595966613774336">March 6, 2014</a></blockquote></p>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


        <div class="entry_content">Tagged
            
              
              <a href="/tag/charting">charting</a>,
              
              <a href="/tag/d3">d3</a>,
              
            
        </div>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ianwootten'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>


      <footer>
        <div class="footer-about">
          I'm a Web Developer  working at <a href="http://niftydigits.com">Nifty Digits</a> in Cardiff, UK. Here, I enjoy talking code - mostly Python/Javascript. I'm <a href="http://twitter.com/iwootten">@iwootten</a> on twitter.
        </div>
      </footer>
    </div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'ianwootten'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
</body>
</html>

