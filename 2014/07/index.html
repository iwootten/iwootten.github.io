<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Ian Wootten - Web Developer, Cardiff</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/fonts/open-sans.css" />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/syntax.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-263865-2', 'ianwootten.co.uk');
      ga('send', 'pageview');

    </script>
    </head>
    <body>


    <div class="container blog">
      <header>
        <nav>
        <ul class="nav">
          <li><a class="blog active" href="/">Blog</a></li>
          <li><a class="javascript" href="/category/javascript">Javascript</a></li>
          <li><a class="web-apps" href="/category/web-apps">Web Apps</a></li>
          <li><a class="about" href="/about">About</a></li>
          <li><a class="contact" href="/contact">Contact</a></li>
        </ul>
        </nav>
        <div class="clear"></div>
      </header>

      

<div class="post">
<h1><a href="/2014/07/31/extracting-shot-thumbnails-using-ffmpeg">Extracting Shot Thumbnails from a video using FFMPEG</a></h1>
<div class="author_meta">31 Jul 2014</div>
<p>Recently, Andy Davies asked the following question on twitter:</p>

<blockquote class="twitter-tweet" data-partner="tweetdeck"><p>Any ideas on how I can easily convert a video to a filmstrip?</p>&mdash; Andy Davies (@AndyDavies) <a href="https://twitter.com/AndyDavies/statuses/491878215464808450">July 23, 2014</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>I found this pretty interesting, especially given I’d used various open source tools for assembling storyboards in the past. I knew it was possible to extract images at desired intervals and left it as that.</p>

<p>After a bit of digging last night, I discovered it’s <a href="http://superuser.com/questions/538112/meaningful-thumbnails-for-a-video-using-ffmpeg">actually possible to extract images based on changes in the video</a>. We can use this to extract a rough approximation to individual shots.</p>

<p>I’ve run the following command on the Big Buck Bunny in order to extract 138 individual changes from the 10 min short. I’m using ffmpeg version 2.3 (I had tried using ffmbc 0.7, but it is unable to parse some of the options).</p>

<div class="highlight"><pre><code class="bash">ffmpeg -ss 3 -i big_buck_bunny_1080p_surround.avi -vf <span class="s2">&quot;select=gt(scene\,0.2)&quot;</span> -vsync vfr -s vga -f image2 out%02d.jpg</code></pre></div>

<p>The real gold here is the ‘-vf “select=gt(scene\,0.2)”’, which grabs scene changes based on a difference in the frame of 20% or more. There are certain discrepancies in a couple of shots, but in the main this method works well and quickly. I specify the output format (-f) and size (-s) so that I can get small thumbs rather than the 1920x1080 the short is in.</p>

<p>You can see how well this performs through the selections made for the first 10 changes shown below.</p>

<p><img src="http://ianwootten.co.uk/images/ffmpeg-board-sample.jpg" title="Sample ffmpeg scene changes" /></p>

<p>In order to assemble the thumbs into an individual image I’ve used the <a href="http://www.imagemagick.org/Usage/montage/">“montage”</a> command from imagemajick.</p>

<div class="highlight"><pre><code class="bash">montage *.jpg -geometry 320x180+2+2 -tile 3x4 sample.jpg</code></pre></div>

<p>This assembles the images in the current directory in a 3x4 grid and outputs them to sample.jpg. If there are more images that will fit in a 3x4 grid, multiple output images will be created to represent the strip.</p>

<p>Animation is a really good exemplar for this technique, probably due to the obvious changes between each shot. However I can imagine it would fare less well with say a live action feature, where scene changes may be more gradual and/or lighting is more subtle.</p>

<div class="entry_content">Tagged <a href="/tag/imagemajick">imagemajick</a>, <a href="/tag/ffmpeg">ffmpeg</a>,  | <a href="/2014/07/31/extracting-shot-thumbnails-using-ffmpeg/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2014/07/01/splitting-a-date-range-in-python">Splitting a date range in Python</a></h1>
<div class="author_meta">01 Jul 2014</div>
<p>Dates are one of those annoying things that shouldn’t be, but are regularly difficult in web apps. I used the following two methods in a recent page to neatly break a date range into distinct segments as part of a analytics app I’m currently working on. Hopefully someone else will find them helpful.</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">calendar</span>

<span class="c"># Find the delta between two dates based on a desired number of ranges</span>
<span class="k">def</span> <span class="nf">datedelta</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">no_of_ranges</span><span class="p">):</span>
    <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">startdate</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
    <span class="n">end_epoch</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">enddate</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>

    <span class="n">date_diff</span> <span class="o">=</span> <span class="n">end_epoch</span> <span class="o">-</span> <span class="n">start_epoch</span>

    <span class="n">step</span> <span class="o">=</span> <span class="n">date_diff</span> <span class="o">/</span> <span class="n">no_of_ranges</span>

    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">step</span><span class="p">)</span></code></pre></div>

<p>date_delta allows me to create the timedeltas between two dates based on a desired number of segments.</p>

<div class="highlight"><pre><code class="python"><span class="c"># Edit 18/07/2014 - I realised dates needed the hrs, mins an secs correctly</span>
<span class="c"># adjusted to beginning / end of day</span>
<span class="k">def</span> <span class="nf">datespan</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
    <span class="n">currentdate</span> <span class="o">=</span> <span class="n">startdate</span>

    <span class="k">while</span> <span class="n">currentdate</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">enddate</span><span class="p">:</span>
        <span class="n">todate</span> <span class="o">=</span> <span class="p">(</span><span class="n">currentdate</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">currentdate</span><span class="p">,</span> <span class="n">todate</span>

        <span class="n">currentdate</span> <span class="o">+=</span> <span class="n">delta</span>
        <span class="n">currentdate</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code></pre></div>

<p>I can then pass the delta into datespan above, which returns an iterable I can then use.</p>

<div class="highlight"><pre><code class="python"><span class="c"># Get timedeltas based on splitting the range by 10</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">date_delta</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">from_datetime</span><span class="p">,</span> <span class="n">to_datetime</span> <span class="ow">in</span> <span class="n">datespan</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">from_datetime</span><span class="p">,</span> <span class="n">to_datetime</span></code></pre></div>

<p>The result forms part of the following d3 chart:</p>

<blockquote class="twitter-tweet" lang="en"><p>Made some updates to that there commerce dashboard (now uses summary ranges on x-axis), what do people think? <a href="http://t.co/AatFxBRnsC">pic.twitter.com/AatFxBRnsC</a></p>&mdash; Ian Wootten (@iwootten) <a href="https://twitter.com/iwootten/statuses/481780932496863233">June 25, 2014</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<div class="entry_content">Tagged <a href="/tag/coding">coding</a>, <a href="/tag/python">python</a>,  | <a href="/2014/07/01/splitting-a-date-range-in-python/#disqus_thread">Leave a comment</a></div>
</div>



<div class="pagination">

  <span class="previous">Previous</span>

<span class="page_number ">Page: 1 of 1</span>

  <span class="next ">Next</span>

</div>

      <footer>
        <div class="footer-about">
          I'm a Web Developer  working at <a href="http://niftydigits.com">Nifty Digits</a> in Cardiff, UK. Here, I enjoy talking code - mostly javascript. I'm <a href="http://twitter.com/iwootten">@iwootten</a> on twitter.
        </div>
      </footer>
    </div>
   <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ianwootten'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
