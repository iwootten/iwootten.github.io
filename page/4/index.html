<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Ian Wootten - Web Developer, Cardiff</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/fonts/open-sans.css" />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/syntax.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-263865-2', 'ianwootten.co.uk');
      ga('send', 'pageview');

    </script>
    </head>
    <body>


    <div class="container blog">
      <header>
        <nav>
        <ul class="nav">
          <li><a class="blog active" href="/">Blog</a></li>
          <li><a class="javascript" href="/category/javascript">Javascript</a></li>
          <li><a class="web-apps" href="/category/web-apps">Web Apps</a></li>
          <li><a class="about" href="/about">About</a></li>
          <li><a class="contact" href="/contact">Contact</a></li>
        </ul>
        </nav>
        <div class="clear"></div>
      </header>

      

<div class="post">
<h1><a href="/2011/09/09/hosting-an-octopress-blog-on-amazon-s3">Hosting an Octopress Blog on Amazon S3</a></h1>
<div class="author_meta">09 Sep 2011</div>
<p><a href="http://octopress.org">Octopress</a> is a framework for blogging based on the static site generator <a href="https://github.com/mojombo/jekyll">jekyll</a>. In short jekyll takes markdown and turns it into blog style html ready to be served straight away with Apache whilst Octopress dresses it up nicely with HTML5, responsive layout goodness and gives you a bunch of options for code formatting and the like. A perfect little blogging setup for hackers for those of us who typically won’t need all the bells and whistles on our blog I’m sure you’ll agree.</p>

<p>Using Octopress, you’d typically write your posts in markdown and process them locally. You’d then have a number of HTML pages to upload to your web server, which would appear no different than any other blog in terms of functionality.</p>

<p>The most interesting thing that coincincides with the creation of jekyll is that it is now possible to serve static websites straight from Amazon S3, meaning that it isn’t neccessary to have a web server to serve a Octopress blog. I’ve been playing a little and have been able to serve my own octopress blog which you can see over at <a href="http://www.ianwootten.com">www.ianwootten.com</a>. Here’s how to do it:</p>

<h2 id="configure-an-s3-bucket-to-act-as-a-website">Configure an S3 Bucket to Act as a Website</h2>

<p>NB: If you want to use your own domain, then you’re going to need to create an S3 bucket from the AWS Console named the same as your domain (so for me I created a bucket called “www.ianwootten.com”. </p>

<p>To configure your bucket as a website, from the AWS Console, select the new bucket and click “Properties”. Choose the “Website” tab from the box that appears and check “enabled” and set the Index document as “index.html”. Click “Save”. Now move to the “permissions” tab and click “Add bucket policy”. Enter a policy as below, with “www.ianwootten.com” replaced with the name of the bucket you’re using.</p>

<p><code>&lt;br /&gt;
{&lt;br /&gt;
	"Version": "2008-10-17",&lt;br /&gt;
	"Id": "",&lt;br /&gt;
	"Statement": [&lt;br /&gt;
		{&lt;br /&gt;
			"Sid": "PublicReadForGetBucketObjects",&lt;br /&gt;
			"Effect": "Allow",&lt;br /&gt;
			"Principal": {&lt;br /&gt;
				"AWS": "*"&lt;br /&gt;
			},&lt;br /&gt;
			"Action": "s3:GetObject",&lt;br /&gt;
			"Resource": "arn:aws:s3:::www.ianwootten.com/*"&lt;br /&gt;
		}&lt;br /&gt;
	]&lt;br /&gt;
}&lt;br /&gt;
</code></p>

<p>If you’ve opted not to use your own domain, then that’s it for S3. Your new bucket website will be available at a combination of the bucket name and the S3 storage location. In my case, this is <a href="http://www.ianwootten.com.s3-website-us-east-1.amazonaws.com/">http://www.ianwootten.com.s3-website-us-east-1.amazonaws.com/</a>. There’s a list of endpoints on the “website endpoints” page in <a href="http://docs.amazonwebservices.com/AmazonS3/latest/dev/index.html?WebsiteHosting.html">Amazons S3 website docs</a>.</p>

<h2 id="configure-dns">Configure DNS</h2>

<p>If you’re wanting to use your own domain, then you’ll need to visit your domain registraar and edit some DNS entries. In my case, I added a CNAME entry “www” pointing to www.ianwootten.com.s3-website-us-east-1.amazonaws.com. You’ll need to use a tool like <a href="http://wwwizer.com">wwwizer</a> in order to forward from the root of your domain to the www subdomain. e.g. “ianwootten.com” to “www.ianwootten.com”. To get that working, you’ll also need to modify the @ A record and point it to 174.129.25.170. Read this <a href="http://serverfault.com/questions/62527/how-to-create-a-cname-for-a-domains-root-name">serverfault post</a> if you’re interested to know why.</p>

<p>For more info on CNAME configuration and S3 see <a href="http://docs.amazonwebservices.com/AmazonS3/latest/dev/index.html?WebsiteHosting.html">Amazons S3 website docs</a> (Specifically the notes on virtual hosting).</p>

<h2 id="download-octopress-and-write-some-markdown">Download Octopress and write some Markdown</h2>

<p>Having successfully configured Amazon S3 to host your blog, you need to tackle the age old problem of writing some content for it. This was particularly hard for me, given my lack of knowledge about markdown! You may like to take a look at <a href="http://daringfireball.net/projects/markdown/basics">John Grubers explanation of markdown</a> if you’re suffering like me. The <a href="http://octopress.org/docs/blogging/">Octopress blogging basics</a> gives a good overview of how your new local blogging workflow will work. Essentially new posts are written in the ./_source/posts folder and when <code>rake generate</code> is executed, your entire websites content is output to the ./public folder. You can also run <code>rake preview</code> in order to preview on a local server.</p>

<p>TO publish your blog, it’s merely a matter of transferring your /public content to the S3 bucket you’ve generated.</p>

<p>Having done all that you’ve now no need to run your own server. You’re still dependent on those that operate at S3, wwwizer and your domain registraar, but you’ve removed your own from the equation. You may be interested in checking out <a href="http://www.jerome-bernard.com/blog/2011/08/20/quick-tip-for-easily-deploying-octopress-blog-on-amazon-s3/">Jerome Bernard’s</a> tip on easily deploying Octopress blogs with <a href="http://s3tools.org/s3cmd">s3cmd</a>.</p>


<div class="entry_content">Tagged <a href="/tag/amazon">amazon</a>, <a href="/tag/blog">blog</a>, <a href="/tag/blogging">blogging</a>, <a href="/tag/godaddy">godaddy</a>, <a href="/tag/jekyll">jekyll</a>, <a href="/tag/octopress">octopress</a>, <a href="/tag/s3">s3</a>,  | <a href="/2011/09/09/hosting-an-octopress-blog-on-amazon-s3#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/07/20/lovefilm-filmstream-plugin-v0-2">Lovefilm Filmstream Plugin v0.2</a></h1>
<div class="author_meta">20 Jul 2011</div>
<p>Just a quick note to say I’ve updated the plugin that generates my <a href="http://ianwootten.co.uk/filmstream">filmstream pages</a>. It’s become obvious that the <a href="http://developer.lovefilm.com">Lovefilm API</a> only exposes the last 10 features that you’ve rented in their “at home” list. This isn’t that great if you’ve been renting more than a few months. This is the same as the information you’d see in your account when logged in.</p>

<p>I’ve made a simple modification to use the actual ids that <a href="http://lovefilm.com">Lovefilm</a> issue for films, rather than a autoincrement value. This way, there’s no need to empty what’s currently stored when updating and we capture the users history of rentals…</p>

<p>You can grab it over <a href="http://www.ianwootten.co.uk/downloads/filmstream.zip">here</a></p>


<div class="entry_content">Tagged <a href="/tag/lovefilm">lovefilm</a>, <a href="/tag/plugins">plugins</a>,  | <a href="/2011/07/20/lovefilm-filmstream-plugin-v0-2#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/07/14/participate-don%e2%80%99t-preach">Participate, Don’t Preach</a></h1>
<div class="author_meta">14 Jul 2011</div>
<p>Last week, tickets went on sale for dConstruct 2011 and sold out within an impressive 7 hours. Having attended in 2010 and 2008 and judging it to be filled with the highest calibre web celebs from across the globe, I coughed up the entrance fee as part of the excited gold-rush. The cost of £150 includes access to the pre and after parties and the conference itself.</p>

<p>These type of events are stuffed to the brim with amazing, intelligent web professionals, many of whom I would consider to be colleagues. I’ve followed their progress, listened to them speak, bought their publications and hacked on code with them at many other previous events.</p>

<p>It’s often quoted within tech circles that the best parts of these events are not the talks themselves, but the networking parties that surround them. I really struggle in these environments, nervously trying to find a crowd I feel comfortable chatting with, introducing myself and trying to strike up some cutting edge debate on the topics of the day. I’m a developer who usually lurks behind a computer screen for 8 hours a day, so why wouldn’t I find it awkward? It feels like uncharted territory every time I find myself there. Although meeting some great, interesting people, I have ultimately never forged any new lasting relations in this way, where the interaction is somewhat forced and artificial. Maybe it’s just me, but given the com mon nature of everyones work, you’d think it might be easier. As a friend once observed – it’s like everyone turns up to sell their product, but there are no buyers.</p>

<p>It’s also great to be able to chat within the inner circle of the celebrities who attend. You’ve heard from them all year round and now have a brief opportunity to chat. I guess really I’d love to bounce questions and thoughts off of these guys all evening, but often I get the feeling I’m being evaluated against the rest of the attendees in the room in terms of worthiness. Until you’re edging<br />
into such circles yourself, I’m not entirely sure what they would get from these conversations either.</p>

<p>In fact, what I have found is that my most fruitful and long lasting relations have been founded at events when in a participatory nature. Most of these have been Hack Days (where you’re invited to quickly hack together software as an exemplar of new apis from a number of vendors) and some of them have been at Bar Camps (where all attendees have to speak on a subject close to their heart). I feel closer to these people than I could ever do with someone I spoke with briefly in a noisy bar. I’ll also remember faces and names of people even if I never had the chance to interact with them.</p>

<p>This year, a new variety of geek meet has arisen, which flip these more traditional events on their heads and instead focus on providing environments that focus on “the best bits”. They allow everyone to participate on level pegging rather than follow a traditional conference structure. Earlier this month there was &lt;a href=“http://geekkart.in”&gt;Geek Karting&lt;/a&gt;, &lt;a href=“http://insitestour.com”&gt;The Insites Tour&lt;/a&gt; is kicking off next week and later this year there’s &lt;a href=“http://preparetoactivate.com”&gt;Activate&lt;/a&gt;. I really like the idea of these as a way of sparking interesting relationships and I’m hopefully going to head to Insites next week to see what Elliot and Keir have been able to cook up. I’d hope to see more of these unusual types of event and ultimately participate in more of them.</p>

<p>I still feel that conferences have their place, otherwise I wouldn’t have coughed up the fee for dConstruct. I enjoy hearing what these illustrious speakers have to say. That part of the event is still important for sparking debate and learning from for months and years afterward. However, I just don’t find surrounding parties as valuable to me as I first would have thought.</p>

<div class="entry_content">Tagged <a href="/tag/dConstruct">dConstruct</a>, <a href="/tag/events">events</a>, <a href="/tag/hacking">hacking</a>, <a href="/tag/Web">Web</a>,  | <a href="/2011/07/14/participate-don%e2%80%99t-preach#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/07/04/maintaining-references-to-sockets-with-express-and-socket-io">Maintaining References to Sockets with Express and Socket.io</a></h1>
<div class="author_meta">04 Jul 2011</div>
<p>I hit a frustrating problem when trying to use expressjs alongside <a href="http://socket.io">socket.io</a> recently. The solution may seem somewhat trivial, but I struggled with it for a while, until finally asking for help on the <a href="http://socket.io">socket.io</a> irc channel. I’m not sure if a better solution exists for my case, but this is what I have for now.</p>

<p>In the main route of my express app, I needed to iterate across an array, performing a REST call using each element as a parameter and spit the results back for socket.io to send out to the browser. To get some idea of what that would look like, imagine the following.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span> <span class="nx">someArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
   <span class="kd">var</span> <span class="nx">someVariable</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
     <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>My problem then became, how do I emit in this way, given my use case? All examples I could find on the <a href="http://socket.io">socket.io</a> homepages demonstrate emitting msgs on connection, like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// send custom events to browser socket</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;i can send&#39;</span><span class="o">:</span> <span class="s1">&#39;json!&#39;</span> <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>But I wanted to emit messages as part of a loop, within an app route. How would I do that? I could wrap the loop with the connection logic:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span> <span class="nx">someArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">someVariable</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
         <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>But if I do this, then my connection listener would be added on every refresh of the route. This would mean I’d end up with duplicate binding of event listeners and a load more results messages would be emitted than I’d expect. This would result in crazy behavior for any user who might choose to refresh your app.</p>

<p>Actually, the solution is rather simple although not entirely obvious given the nature of using node. If you maintain a reference to the socket as a global variable and then later emit upon that same socket, like so:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">global_socket</span><span class="p">;</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">global_socket</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span> <span class="nx">someArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">someVariable</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
      <span class="nx">global_socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>This way, a connection will be established and maintained and we won’t get duplicate bindings when refreshing the route of the app. Simple when you know how. I had a rather interesting discussion following this on irc about whether the use of express and socket.io together is warranted, given that socket.io supports use of variable passing and ultimately could entirely replace an express app.</p>


<div class="entry_content">Tagged <a href="/tag/express">express</a>, <a href="/tag/expressjs">expressjs</a>, <a href="/tag/node">node</a>, <a href="/tag/nodejs">nodejs</a>, <a href="/tag/socket.io">socket.io</a>,  | <a href="/2011/07/04/maintaining-references-to-sockets-with-express-and-socket-io#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/05/07/updating-wordpress-automatically-over-sftp">Updating WordPress Automatically over SFTP</a></h1>
<div class="author_meta">07 May 2011</div>
<p>Heres a quick how to on getting wordpress to update over SFTP. On a default install of php, wordpress only gives the option to update over FTP. I wanted to get it working as it’s more secure and means I don’t have to open up FTP on my virtual server and open another port up in the firewall.</p>

<p>I’m using ubuntu and the sequence of commands I followed were:</p>

<pre class="bash">sudo apt-get install libssh2-1-dev libssh2-php
</pre>

<p>You should now find that if you list the modules installed in php and check if ssh2 is now there, you get the result “ssh2″:</p>

<pre class="bash">php -m | grep ssh2
</pre>

<p>You’ll need to restart apache for the changes to begin being used.</p>

<pre class="bash">sudo /etc/init.d/apache2 restart
</pre>

<p>If you head to updates in your dashboard, you should now see an extra option “SSH2″ and spaces for public and private authentication keys. I had to head back to the terminal and create these particular files.</p>

<pre class="bash">cd ~
ssh-keygen
cat .ssh/id_rsa.pub &gt;&gt; .ssh/authorized_keys
chmod 755 .ssh
chmod 644 .ssh/*
sudo chown -R ian:www-data /var/www/pathtowordpress/
</pre>

<p>Now you can head into the updates page again, enter your username and password and the locations to your public and private keys (/home/ian/.ssh/id_rsa.pub and /home/ian/.ssh/id_rsa in my case). If you’re running ssh on a non standard port, be sure to append that to your hostname. </p>

<p>Thanks to the following helpful posts: http://kevin.vanzonneveld.net/techblog/article/make_ssh_connections_with_php/</p>

<div class="entry_content">Tagged <a href="/tag/sftp">sftp</a>, <a href="/tag/update">update</a>,  | <a href="/2011/05/07/updating-wordpress-automatically-over-sftp#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/03/31/a-survey-of-hype-in-web-development-podcasts">A Survey of Hype in Web Development Podcasts</a></h1>
<div class="author_meta">31 Mar 2011</div>
<p>I listen to quite a few web dev podcasts. Something that irks me about a lot of them, is how much they tend to hype their own shows, products or the like. Sure, they’re allowed to, it is their own podcast after all, often from their own businesses etc. I’m fully aware this all possibly contributes toward the success of shows, but it annoys me nonetheless. </p>

<p>One of these things is the title of the show itself. I don’t really get why its necessary to repeat the title (Sure I do really, to drum it into my head), given it’s going to be within the title of the mp3. I know what I’m listening to after all, because my favourite media player tells me. </p>

<p>I’ve been wanting to count the number of times a show utters it’s name over its duration. Sure, I realise this is somewhat ocd and geeky, but hey. Here’s my results for a typical set of podcasts that I often listen to in a week. I’ve linked up the data I’ve used to create this chart on <a href="https://spreadsheets.google.com/ccc?key=0AiyMcCUnltKwdG85QnNKMnhneUVXMjJNUzVCa0kzNEE&#038;hl=en&#038;pli=1&#038;authkey=CJbb9a0L#gid=0">google spreadsheets</a>, for anyone else who may be interested to contribute to and build upon further. I gathered the data all myself by listening to each podcast and counting when mentions of the show were made but it may be a good excuse for me to experiment with amazon turk. </p>

<p>The big web show comes out tops with one mention over 40 mins worth of show and boagworld comes last with 24 mentions of the show over its duration. (It’s unfortunate for boagworld that its theme tune includes a voice repeating the title in the theme. I did originally include echos, which would be 34 mentions, but my colleagues inform me this may be taking the experiment a little too far :))</p>

<p>I plan to do the same for product mentions (adverts I guess) in a weeks worth of (different) episodes, but if anyone wants to go ahead and update with their own findings that would be great.</p>

<p><a href="http://www.ianwootten.co.uk/wp-content/uploads/2011/03/chart_1.png"><img src="http://www.ianwootten.co.uk/wp-content/uploads/2011/03/chart_1.png" alt="" title="Own Web Show Mentions per Minute" width="600" height="371" class="alignnone size-full wp-image-445" /></a></p>


<div class="entry_content">Tagged <a href="/tag/Web Apps">Web Apps</a>, <a href="/tag/web development">web development</a>,  | <a href="/2011/03/31/a-survey-of-hype-in-web-development-podcasts#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/02/07/blog-rolling-with-couchdb-express-and-node-js">Blog rolling with CouchDB, Express and Node.js</a></h1>
<div class="author_meta">07 Feb 2011</div>
<p>Over the last little while, I’ve been doing a lot of playing with <a href="http://nodejs.org">Node.js</a>, mostly to run data collection scripts. Last week, I started following <a href="http://howtonode.org/express-mongodb">Ciaran Jessup’s tutorial</a> on getting started with <a href="http://nodejs.org">node.js</a>, <a href="http://github.com/visionmedia/express">Express</a> and <a href="http://www.mongodb.org/">mongoDB</a>. Express acts as a framework to node.js, allowing you to work in a familiar mvc format in a not so familar <a href="http://en.wikipedia.org/wiki/JavaScript">server side language</a>. I hit a few problems along the way in the tutorial, so I thought I’ve list a few of my findings here. I also wanted to make use of my preferred flavour of nosql – <a href="http://couchdb.apache.org/">couchdb</a> with express, which proved extremely easy to port the mongo model over to it. I hope someone out there finds this useful as I’ve yet to find a vast community using couchdb/express.</p>

<p>First things first, you’ll want to install <a href="http://nodejs.org">Node</a> and <a href="http://npmjs.org">npm</a> (the node package manager) in order to be able to easily install node packages. You’ll also probably find it handy to have the <a href="http://howtonode.org/express-mongodb">original tutorial open</a> alongside this one. I’ve been using the latest versions of node (0.3.7) and npm (0.2.17) at the time of writing.</p>

<p>Once that’s done, grab copies of the packages that we’ll be using:</p>

<div class="highlight"><pre><code class="bash">npm install express</code></pre></div>

<div class="highlight"><pre><code class="bash">npm install jade</code></pre></div>

<div class="highlight"><pre><code class="bash">npm install sass</code></pre></div>

<p>If you want to use couchdb, then make sure you have it installed – grab it over <a href="http://www.couchone.com/get">here</a> and then install the package for talking to node.</p>

<div class="highlight"><pre><code class="bash">npm install cradle</code></pre></div>

<p>The first hurdle I found was that the way in which that express is called has changed a little.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyDecoder</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">());</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre></div>

<p>Then by saving to a file called app.js and calling using:</p>

<div class="highlight"><pre><code class="bash">node app.js</code></pre></div>

<p>Once that’s done. You can then visit 127.0.0.1:3000 in your browser to see a rivetting message!</p>

<p>After creating folder beneath our original app.js in which to put views, you can use the original <a href="http://howtonode.org/express-mongodb/articleprovider-memory.js">article provider file</a> and the updated app.js below in order to have an app with a few articles shown.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ArticleProvider</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./articleprovider-memory&#39;</span><span class="p">).</span><span class="nx">ArticleProvider</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyDecoder</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">());</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">articleProvider</span><span class="o">=</span> <span class="k">new</span> <span class="nx">ArticleProvider</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">articleProvider</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sys&#39;</span><span class="p">).</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">docs</span><span class="p">));</span>
  <span class="p">})</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre></div>

<p>Now when you re-run, you’ll see 3 separate articles. Oooh fancy!</p>

<p>Next I hit my first hurdle. Express no longer uses the HAML HTML template language and instead uses JADE by default. This requires converting the HAML templates across to their equivalent JADE counterparts. Basically, this is as simple as dropping the ‘%’ from the beginning of each line (I also replaced braces with brackets in later templates).</p>

<div class="highlight"><pre><code class="jade"><span class="nt">html</span>
  <span class="nt">head</span>
    <span class="nt">title</span><span class="p">=</span> <span class="n">title</span>
    <span class="nt">link</span>(<span class="na">rel:</span> <span class="err">&#39;</span><span class="na">stylesheet</span><span class="err">&#39;,</span> <span class="na">href:</span> <span class="err">&#39;/</span><span class="na">style</span><span class="err">.</span><span class="na">css</span><span class="err">&#39;</span> )
  <span class="nt">body</span>
    <span class="nf">#wrapper</span>
      <span class="err">!= </span><span class="nt">body</span></code></pre></div>

<div class="highlight"><pre><code class="jade"><span class="nt">h1</span><span class="p">=</span> <span class="n">title</span>
<span class="nf">#articles</span>
  <span class="p">-</span> <span class="n">each</span> <span class="n">article</span> <span class="n">in</span> <span class="n">articles</span>
    <span class="nt">div</span><span class="nc">.article</span>
      <span class="nt">div</span><span class="nc">.created_at</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">created_at</span>
      <span class="nt">div</span><span class="nc">.title</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span>
      <span class="nt">div</span><span class="nc">.body</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">body</span></code></pre></div>

<p>The app.js now becomes:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;jade&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyDecoder</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">compiler</span><span class="p">({</span> <span class="nx">src</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">,</span> <span class="nx">enable</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;sass&#39;</span><span class="p">]</span> <span class="p">}));</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ArticleProvider</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./articleprovider-memory&#39;</span><span class="p">).</span><span class="nx">ArticleProvider</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">articleProvider</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;blogs_index.jade&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">locals</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Blog&#39;</span><span class="p">,</span>
        <span class="nx">articles</span><span class="o">:</span> <span class="nx">docs</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/*.css&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.css.sass&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">layout</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre></div>

<p>You’ll notice that here we enable the CSS compiler sass and HTML compiler jade. If you download the original <a href="http://howtonode.org/express-mongodb/views/style.css.sass">sass CSS template</a> into your views folder, you can now restart the app and inspect the fruits of your labour. The CSS shouldn’t actually sit in the views folder, according to the creator of Express, and should instead should be compiled with the sass package itself. I’ve yet to discover the correct way of doing this. To request a stylesheet in the view, we need to do the following:</p>

<div class="highlight"><pre><code class="jade"><span class="nt">html</span>
  <span class="nt">head</span>
    <span class="nt">title</span><span class="p">=</span> <span class="n">title</span>
    <span class="nt">link</span>(<span class="na">rel:</span> <span class="err">&#39;</span><span class="na">stylesheet</span><span class="err">&#39;,</span> <span class="na">href:</span> <span class="err">&#39;/</span><span class="na">style</span><span class="err">.</span><span class="na">css</span><span class="err">&#39;</span> )
  <span class="nt">body</span>
    <span class="nf">#wrapper</span>
      <span class="err">!= </span><span class="nt">body</span></code></pre></div>

<p>If you reload now and visit <a href="http://127.0.0.1:3000">127.0.0.1:3000</a> you should see your posts with a little more style.</p>

<p>Creating a form for new posts looks like this:</p>

<div class="highlight"><pre><code class="jade"><span class="nt">h1</span><span class="p">=</span> <span class="n">title</span>
<span class="nt">form</span>( <span class="na">method=</span> <span class="s">&#39;post&#39;</span> )
  <span class="nt">div</span>
    <span class="nt">div</span>
      <span class="nt">span</span> Title :
      <span class="nt">input</span>(<span class="na">type=</span><span class="s">&#39;text&#39;</span><span class="err">,</span> <span class="na">name=</span> <span class="s">&#39;title&#39;</span><span class="err">,</span> <span class="na">id=</span> <span class="s">&#39;editArticleTitle&#39;</span> )
    <span class="nt">div</span>
      <span class="nt">span</span> Body :
      <span class="nt">textarea</span>( <span class="na">name=</span> <span class="s">&#39;body&#39;</span><span class="err">,</span> <span class="na">rows=</span> <span class="nv">20</span><span class="err">,</span> <span class="na">id=</span> <span class="s">&#39;editArticleBody&#39;</span> )
    <span class="nt">div</span><span class="nf">#editArticleSubmit</span>
      <span class="nt">input</span>( <span class="na">type=</span> <span class="s">&#39;submit&#39;</span><span class="err">,</span> <span class="na">value=</span> <span class="s">&#39;Send&#39;</span> )</code></pre></div>

<p>And the new app.js routes are as follows:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/blog/new&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;blog_new&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">locals</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;New Post&#39;</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/blog/new&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">articleProvider</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
    <span class="nx">body</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">docs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>In order to add persistence using mongodb, nothing changes in the original model file, <a href="http://howtonode.org/express-mongodb/articleprovider-mongodb.js">so go ahead and use that</a>. You’ll need to have installed the package ‘mongodb’ if you’d like to try out using it though and update your instantiation of the articleprovider class by supplying a port number to which mongo is installed.</p>

<h1 id="adding-couchdb-persistence">Adding CouchDB Persistence</h1>

<p>Here, I took my own angle on the tutorial and decided to give attempting to make my own persistence model using couchdb a go. It proved to be extremely easy, given the JSON representation and HTTP/GET method of access already built in to it.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">cradle</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cradle&#39;</span><span class="p">);</span>

<span class="nx">ArticleProvider</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">cradle</span><span class="p">.</span><span class="nx">Connection</span><span class="p">)(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">cache</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">raw</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">database</span><span class="p">(</span><span class="s1">&#39;articles&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">ArticleProvider</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;articles/all&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="nx">error</span> <span class="p">){</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="kd">var</span> <span class="nx">docs</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">){</span>
          <span class="nx">docs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">docs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">ArticleProvider</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
        <span class="k">else</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
      <span class="p">});</span>
<span class="p">};</span>

<span class="nx">ArticleProvider</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">articles</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">articles</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
      <span class="nx">articles</span> <span class="o">=</span> <span class="p">[</span><span class="nx">articles</span><span class="p">];</span>

    <span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span> <span class="nx">articles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">article</span> <span class="o">=</span> <span class="nx">articles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">article</span><span class="p">.</span><span class="nx">created_at</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span> <span class="nx">article</span><span class="p">.</span><span class="nx">comments</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="nx">article</span><span class="p">.</span><span class="nx">comments</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">j</span><span class="o">&lt;</span> <span class="nx">article</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">article</span><span class="p">.</span><span class="nx">comments</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">created_at</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">articles</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
      <span class="k">else</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">articles</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">ArticleProvider</span> <span class="o">=</span> <span class="nx">ArticleProvider</span><span class="p">;</span></code></pre></div>

<p>I added the following view and route to my app.js too, to allow support for clicking upon articles.</p>

<div class="highlight"><pre><code class="jade"><span class="nt">div</span><span class="nc">.article</span>
  <span class="nt">h1</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span>
  <span class="nt">div</span><span class="nc">.created_at</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">created_at</span>
  <span class="nt">div</span><span class="nc">.body</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">body</span></code></pre></div>

<div class="highlight"><pre><code class="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/blog/view/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
   <span class="nx">articleProvider</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
       <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;blog_view&#39;</span><span class="p">,</span> <span class="p">{</span>
       <span class="nx">locals</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;New Post&#39;</span><span class="p">,</span>
         <span class="nx">article</span><span class="o">:</span> <span class="nx">doc</span>
       <span class="p">}</span>
     <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>And in order to support it, the main view now becomes as follows:</p>

<div class="highlight"><pre><code class="jade"><span class="nt">h1</span><span class="p">=</span> <span class="n">title</span>
<span class="nf">#articles</span>
  <span class="p">-</span> <span class="n">each</span> <span class="n">article</span> <span class="n">in</span> <span class="n">articles</span>
    <span class="nt">div</span><span class="nc">.article</span>
      <span class="nt">div</span><span class="nc">.created_at</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">created_at</span>
      <span class="p">-</span> <span class="k">var</span> <span class="n">articlelink</span> <span class="k">=</span> <span class="-Symbol">&#39;blog</span><span class="o">/</span><span class="n">view</span><span class="o">/</span><span class="err">&#39;</span> <span class="o">+</span> <span class="n">article</span><span class="o">.</span><span class="nc">_id</span><span class="o">;</span>
      <span class="nt">a</span>(<span class="na">href=</span><span class="nv">articlelink</span>)
        <span class="nt">div</span><span class="nc">.title</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span>
      <span class="nt">div</span><span class="nc">.body</span><span class="p">=</span> <span class="n">article</span><span class="o">.</span><span class="n">body</span>

  <span class="nt">a</span>(<span class="na">href=</span><span class="s">&#39;blog/new&#39;</span>)
    <span class="nt">Add</span> new post</code></pre></div>

<p>Anyway, so far I’ve not yet added comment support, but given the headway I made here, I’d imagine it would be extremely easy to integrate into my couchdb article model. I’ll update here if I ever get round to adding it!</p>


<div class="entry_content">Tagged <a href="/tag/couchdb">couchdb</a>, <a href="/tag/expressjs">expressjs</a>, <a href="/tag/mongdb">mongdb</a>, <a href="/tag/node">node</a>, <a href="/tag/nodejs">nodejs</a>,  | <a href="/2011/02/07/blog-rolling-with-couchdb-express-and-node-js#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2010/11/28/amazon-associates-wordpress-wishlist-plugin-is-no-more">Amazon Associates WordPress Wishlist Plugin is No More</a></h1>
<div class="author_meta">28 Nov 2010</div>
<p>I think my post title says it all really. I’ve just discovered that amazon has deprecated use of its ListLookup method since October 15th. I had used this in order to retrieve details of my amazon wishlist and display neatly on my blog using <a href="http://www.ianwootten.co.uk/2008/04/02/amazon-associates-wordpress-wishlist-plugin">my wishlist plugin</a>. Now it seems I’m forced to generate one with their own widget builder. This in turn means my wordpress plugin will no longer work. Sorry for those who were making use of it, or would like to use it. It’s also apparent that this is a kick in the teeth for developers building sites entirely dependant on this method. <a href="https://forums.aws.amazon.com/thread.jspa?threadID=53342">This chap estimates he made $11k in the last year using this function</a>. This is the trouble with building stuff that relies on third party services. I wonder how much more of their api they will gradually remove?</p>


<div class="entry_content">Tagged  | <a href="/2010/11/28/amazon-associates-wordpress-wishlist-plugin-is-no-more#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2010/09/09/installing-gphoto-on-snow-leopard">Installing gPhoto on Snow Leopard</a></h1>
<div class="author_meta">09 Sep 2010</div>
<p>I always seem to choose the difficult route to do things. Having become equipped with a new canon camera, I’m instantly wanting to capture stop motion shorts with it. Unfortunately canons proprietry capture software isn’t really up to the job and FrameByFrame doesn’t work with such high-end cameras.</p>

<p>So, I got to thinking wether there was any other route? I was aware of the <a href="http://www.gphoto.org/">gPhoto</a> commandline interface and libgphoto pointed out by a <a href="http://www.txm.net/">colleague</a> some time ago, so I thought I’d see what I might be able to do with it.</p>

<p>It is possible to install gPhoto using macports, but I chose to compile from source. Here’s how to do it if anyone else is interested.</p>

<p>Install <a href="http://sourceforge.net/project/showfiles.php?group_id=1674&#038;package_id=277626">libusb</a> &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>Install <a href="http://sourceforge.net/project/showfiles.php?group_id=1674&#038;package_id=277627">libusb compat</a> &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #007800;">LIBUSB_1_0_CFLAGS</span>=-I<span style="color: #000000; font-weight: bold;">/</span>usr<span style="color: #000000; font-weight: bold;">/</span>local<span style="color: #000000; font-weight: bold;">/</span>include<span style="color: #000000; font-weight: bold;">/</span>libusb-<span style="color: #000000;">1.0</span> <span style="color: #007800;">LIBUSB_1_0_LIBS</span>=<span style="color: #ff0000;">"-L/usr/local/lib -lusb-1.0"</span>
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>Install <a href="http://sourceforge.net/projects/libexif/files/">libexif</a> &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>Install &lt;a href=http://www-rocq.inria.fr/~gilbert/modulopt/libopt/libopt.tgz”&gt;libopt&lt;/a&gt; &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>Install <a href="http://sourceforge.net/projects/gphoto/files/">libgphoto2</a> (it may not be neccessary to restrict to a subset of drivers as I have done here, but on my macbook it wouldn’t compile unless I did so.) &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--with-drivers</span>=canon
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>Install <a href="http://tiswww.case.edu/php/chet/readline/rltop.html">readline</a> &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>Install <a href="http://sourceforge.net/projects/gphoto/files/">gphoto</a> &lt;div class="wp_syntax"&gt;</p>
<table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>configure
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
      </td>
    </tr>
  </table>
<p>&lt;/div&gt;</p>

<p>You now should be able to capture, download, setup timelapses all from your terminal. See the <a href="http://www.gphoto.org/doc/manual/using-gphoto2.html">full list of examples</a> on the <a href="http://www.gphoto.org/">gphoto homepage</a>.</p>

<p>In my own experiments, I’ve found I’ve mad to kill the PTP software that is initially fired up by the mac in order for gphoto to be able to communicate over usb. It also seems that any files I capture are not written to the memory card (or listed using the –list-files argument), meaning I need to use the –capture-image-and-download argument to capture direct to my machine. I’ve not had much time to experiment yet, so there may be another workaround.</p>

<p>Anyway, its not a stop motion app yet, but it’s a start!</p>


<div class="entry_content">Tagged <a href="/tag/camera">camera</a>, <a href="/tag/code">code</a>, <a href="/tag/stop motion">stop motion</a>,  | <a href="/2010/09/09/installing-gphoto-on-snow-leopard#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2010/07/24/how-not-to-do-a-hack-day">How not to: Do A Hack Day</a></h1>
<div class="author_meta">24 Jul 2010</div>
<p>It’s been well over a month since I attended <a href="http://sciencehackday.com">science hack day</a> and I’d thought I’d put out some notes on my time there. Rather than do a run down of the event, for which I’m sure there’s far more comprehensive blog posts available already, I thought I’d share my experiences based on attendance of a number of different hack events I’ve been to over the years. I went with the full intention of doing some hardcore hacking, but didn’t entirely meet my own expectations. Here’s my top tips, for now not to do a hack day:</p>

<ul>
  <li>1: Don’t bother coming prepared – You’ve got 24 hours, and you’re bound to be the best coder at the event. You’ll have a unique idea and get that app finished in no time! No, far better to kick back and relax before setting on your way and conduct your research on what’s possible when you arrive.</li>
  <li>2: Arrive fashionably late – 24 hours is ages, and you know all the apis that presentations are going to cover. Nothing says “I’m superior” more than waltzing in a couple of hours late to the event whilst everyone else has been busy sweating it out already.</li>
  <li>3: Keep your distance from other attendees – Your idea is your own and you’ll want to claim all the glory for it after the event. Where’s the glory in letting people know you’re one of 10 people involved? Keep your app under wraps before that all important presentation at the end, the audience will be in total awe of you and flock to your side afterwards.</li>
  <li>4: Be sure to leave the event – You enjoy your sleep right? Why lose it by camping out on some office floor space, when you can head home to your comfy bed or to a hotel and return in the morning? This way, you also get to avoid all that small talk with big name, high profile coders who will belittle you with their outstanding knowledge of their own companies apis.</li>
  <li>5: Have your fill of the free refreshments – Free beer and pizza? Wow, these are a must for any late night software development project. There’s nothing better than feeling stuffed full of dominos and slightly rosy whilst trying to get your brain working at full throttle.</li>
  <li>6: Don’t prepare for your presentation – You’ll need every last second for building your app and the presentation is only a minute long. You might as well just attempt something of the cuff. Don’t worry about connections to your laptop, because those things always work and organisers like <a href="http://adactio.com/">adactio</a> are most amicable about trying to organise it for you along with 30 others at the same time.</li>
</ul>

<p>I attended <a href="http://sciencehackday.com">Science Hack Day</a> and collaborated with a <a href="http://openobjects.blogspot.com">Mia</a>, <a href="http://dharmafly.com">Prem</a>, <a href="http://tommorris.org/blog/">Tom Morris</a>, <a href="http://yaili.com/">Inayaili de León</a>, <a href="http://twitter.com/goodonpaper">Andy McMillan</a> and Richard Boulton in order to build an app titled <a href="http://dharmafly.com/scihack">“The Revolutionaries”</a>. Both Inayaili and Andy I never even spoke to and it was only through Prem’s organisation that the app came through in the end. I spent 2 hours of the event commuting to and from the guardian’s offices and 1 more stuck in a stationary tunnel in the dark. I’m glad that a made an effort though as the <a href="http://dharmafly.com/revolutionaries/">net result was a great app</a>, which even won a little prize. I probably won’t be heeding much of the above advice at future events.</p>


<div class="entry_content">Tagged <a href="/tag/hacking">hacking</a>, <a href="/tag/sciencehackday">sciencehackday</a>,  | <a href="/2010/07/24/how-not-to-do-a-hack-day#disqus_thread">Leave a comment</a></div>
</div>



<div class="pagination">

  <a href="/page/3" class="previous">Previous</a>

<span class="page_number ">Page: 4 of 28</span>

  <a href="/page/5" class="next">Next</a>

</div>

      <footer>
        <div class="footer-about">
          I'm a Web Developer  working at <a href="http://niftydigits.com">Nifty Digits</a> in Cardiff, UK. Here, I enjoy talking code - mostly javascript. I'm <a href="http://twitter.com/iwootten">@iwootten</a> on twitter.
        </div>
      </footer>
    </div>
   <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ianwootten'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
