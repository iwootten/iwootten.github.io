<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Ian Wootten - Web Developer, Cardiff</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/fonts/open-sans.css" />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/syntax.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-263865-2', 'ianwootten.co.uk');
      ga('send', 'pageview');

    </script>
    </head>
    <body>


    <div class="container blog">
      <header>
        <nav>
        <ul class="nav">
          <li><a class="blog active" href="/">Blog</a></li>
          <li><a class="javascript" href="/category/javascript">Javascript</a></li>
          <li><a class="web-apps" href="/category/web-apps">Web Apps</a></li>
          <li><a class="about" href="/about">About</a></li>
          <li><a class="contact" href="/contact">Contact</a></li>
        </ul>
        </nav>
        <div class="clear"></div>
      </header>

      

<div class="post">
<h1><a href="/2012/09/04/recovering-images-from-sd-cards-with-photorec">Recovering Images from SD Cards with PhotoRec</a></h1>
<div class="author_meta">04 Sep 2012</div>
<p>I had the horrible situation last Sunday following removing a number of pictures using an SD reader from my SD card that when I inserted it in my camera, it registered nothing upon it. My heart sunk, because this card is stuffed full of images of me and my family (along with my 1 year old son growing up) and I was unsure of which ones I’d actually backed up. After perusing the hidden files on the card, all I could discover was the files I’d most recently transferred from the card….great…</p>

<p>Partly this was my own fault – I’d already experienced problems with the reader in question when trying to write images for my <a href="http://raspberrypi.org">Raspberry Pi</a> and shouldn’t have used it for transferring images I care about. The card in question is a uber cheapo <a href="http://www.amazon.co.uk/Integral-USB-Single-Slot-Reader/dp/B000VY80AM/ref=sr_1_1?ie=UTF8&#038;qid=1346533453&#038;sr=8-1">Integral USB 2.0</a>. Despite what the amazon reviews say, steer well clear of it – this has been a pain from day one, with intermittent transfer problems which triggered this situation.</p>

<p>After a little more digging, I came across <a href="http://www.cgsecurity.org/wiki/PhotoRec">Photorec</a>, a commandline utility which seemed like it would hopefully help recover some of the images. I attempted to use it with my card reader, but given it’s credentials I’ve given above, found the scanning process would cut out and couldn’t get through the whole card. At this point the card was being reported empty….great…Given the way PhotoRec works, I understood it would still be possible to extract the images despite this. I decided to order another reader and hold fire until it had arrived – this time I opted for a <a href="http://www.amazon.co.uk/Kingston-Technology-Multi-Card-Reader/dp/B007PFQ0PC/">Kingston USB 3.0</a> (which I haven’t had any such problems with so far).</p>

<h2 id="the-solution">The Solution</h2>

<p>Here are the steps I followed after receiving my new sd reader to recover images from the card using PhotoRec. I’m listing them for anyone else who may have the same horrendous stomach wrenching problem I did last Sunday. It seems to have worked pretty well, with only 1 movie file coming out corrupted and about 500 images recovered.</p>

<p>Firstly, I wanted to take a copy of the card as it currently stood following my investigation. For this I used df, diskutil and ddrescue.</p>

<p>To determine where the card is currently mounted (look for the one that’s about the right size):</p>

<pre class="bash">df -h
</pre>

<p>To unmount the card so we can fiddle with it:</p>

<pre class="bash">sudo diskutil unmount /dev/disk1s1
</pre>

<p>To backup the card to a disk image on your macbook:</p>

<pre class="bash">sudo ddrescue /dev/disk1s1 ./sdbackup/image.img backuplog
</pre>

<p>Finally, using PhotoRec scan the disk image that was just created. My image was FAT formatted I scanned the whole thing rather than just unallocated blocks.</p>

<pre class="bash">sudo ./photorec ~/sdbackup/image.img
</pre>

<p>The final piece of this saga was to rename all the files PhotoRec created so they were in folders according to their exif data. My photos are all in folders like “2012_06_30″, so to have 500 files named “f0677440.jpg”, “f0688768.jpg” in a random PhotoRec directory would be pretty annoying. I had looked at setting up an automator task for this, but I ended up using <a href="http://www.petrosit.de/index.php/apps/12-pexiftool">PexifTool</a> for simplicities sake (I’m sure there are other alternatives). I believe if you go the Automator route, you may well have to install plugins in order to be able to extract exif data from files.</p>


<div class="entry_content">Tagged <a href="/tag/linux">linux</a>, <a href="/tag/mac">mac</a>, <a href="/tag/photorec">photorec</a>,  | <a href="/2012/09/04/recovering-images-from-sd-cards-with-photorec/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/08/29/a-scientist-in-an-adventure-with-pirates">A Scientist in an Adventure with Pirates</a></h1>
<div class="author_meta">29 Aug 2012</div>
<p>This is a talk I did back in May at <a href="http://unifieddiff.co.uk">unifieddiff</a> about my time working as a web developer at Aardman Features. I talk quite a bit about the production process and what we take from staff in order to help them do their jobs properly. I quite enjoyed giving this talk – more so than those I’ve given in an academic capacity in the past.</p>


<div class="entry_content">Tagged <a href="/tag/films">films</a>, <a href="/tag/stop motion">stop motion</a>,  | <a href="/2012/08/29/a-scientist-in-an-adventure-with-pirates/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/08/13/youre-nowhere-near-as-good-a-hacker-as-you-think">You’re Nowhere Near as Good a Hacker as You Think</a></h1>
<div class="author_meta">13 Aug 2012</div>
<p>What are you doing? Why would you go down that road? Shouldn’t you be building something else? How long have you been doing this?</p>

<p>Sure you can fool your clients into thinking you’re adding value to their product. I know the truth. But how did you – with all your expertise get to the point in thinking that’s what you’re really doing?</p>

<p>This is your first project? Shouldn’t you be focusing on your clients problems? </p>

<p>Why are you busily building a framework, when you’re already overdue? You know there’s any flavour of ORM available already right? What’s wrong with you? Where are your requirements?</p>

<p>Do you think that you’re going to be able to produce something better than the thousands of contributors to that open source project you’re avoiding using? They’ve been doing it for years already, for thousands of use cases. You think somehow yours falls outside it’s catchment area? Seriously? How arrogant are you?</p>

<p>You’ve been blinkered into thinking you’re an expert in areas you’re not. When your time is spent solving the wrong problems and you’re not invited back, I hope you’ll realise that you’re nowhere near as good a hacker as you think.</p>

<div class="entry_content">Tagged <a href="/tag/advice">advice</a>, <a href="/tag/code">code</a>, <a href="/tag/freelance">freelance</a>,  | <a href="/2012/08/13/youre-nowhere-near-as-good-a-hacker-as-you-think/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/06/12/where-does-steam-store-indie-game-the-movie">Where does Steam store Indie Game The Movie?</a></h1>
<div class="author_meta">12 Jun 2012</div>
<p>A quickie – but for all those that have downloaded “Indie Game the Movie” today from steam and are wondering where the video files are stored, you can find them here:</p>

<p>Steam/SteamApps/common/Indie Game The Movie/data/movies</p>

<div class="entry_content">Tagged <a href="/tag/gamer">gamer</a>, <a href="/tag/games">games</a>, <a href="/tag/indie">indie</a>, <a href="/tag/movie">movie</a>,  | <a href="/2012/06/12/where-does-steam-store-indie-game-the-movie/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/05/03/if-you-build-it">If You Build It</a></h1>
<div class="author_meta">03 May 2012</div>
<p>If my years in academia have taught me anything, it’s that insight obvious to you isn’t often obvious to others. </p>

<p>As a result, I’ve pretty much adopted a gung-ho hacker attitude towards getting my own ideas built whereby I’ll just often work to get an iteration of an site out as fast as possible. The only factor here is my own time and I’m in the fortunate position to have some of that available now and again. There’s a variety of reasons why I might attempt a project, ranging from it may later evolve into something able to draw an income further down the line, that I’m excited by learning from the tools I choose to use or that I feel moved enough by a problem to do something to try and prompt change. </p>

<p>I had one of these ideas last weekend, whereby I was wondering what the specifics of the fees of kickstarter projects broke down to. The information on what fees are taken is published <a href="http://www.kickstarter.com/help/faq/creating%20a%20project#WhatFeesDoesKickChar" title="what fees does kickstarter charge">on their site</a>, so I set about a simple phantomjs script (available <a href="https://github.com/niftydigits/kickstarter.js">on github</a>) that could scrape the information from kickstarter. After doing so, the idea moved on to graphing said information via an app to a simple raphaeljs and again further once I’d realised some other stats that could be gathered from the info I was grabbing. The end result is <a href="http://starterstats.com">Starter Stats</a> – which is, (I think) a neat little site for showing stats on any kickstarter project.</p>

<p><a href="http://starterstats.com/projects/597507018/pebble-e-paper-watch-for-iphone-and-android"><img src="http://www.ianwootten.co.uk/wp-content/uploads/2012/05/Screen-Shot-2012-05-03-at-10.16.42-1024x817.png" alt="" title="Starter Stats" width="640" height="510" class="alignnone size-large wp-image-536" /></a></p>

<p>It took a little longer than I’d hoped, but I’m really pleased with the final site as it stands. You should also be able to just replace the beginning of any kickstarter project page (http://kickstarter.com) with “http://starterstats.com” and you’ll be sent to the relevant stats page on the app. Pages are generated on-demand every 15 minutes. Go on, take a look and let me know what you think.</p>

<p>I could have not spent my time on this, instead kicking back and waiting for someone else to build such a tool. But I couldn’t see that happening. No, better for me to build, learn whilst doing so and move on to my next project. What do you get by not building?</p>


<div class="entry_content">Tagged <a href="/tag/kickstarter">kickstarter</a>, <a href="/tag/phantomjs">phantomjs</a>, <a href="/tag/raphaeljs">raphaeljs</a>,  | <a href="/2012/05/03/if-you-build-it/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/03/01/how-to-switch-your-vps-in-2-hours">How to Switch Your VPS in 2 Hours</a></h1>
<div class="author_meta">01 Mar 2012</div>
<p>Friday last week I woke up to a barrage of emails coming into my inbox. All of these were coming from notification of spam comments upon this very blog. By the time I’d woken up I’d had something like 75 emails. This was pretty strange given that Akismet was there guarding my blog ever since it’s been available and I’d never had a email about a dodgy comment since I’d set it up (something like 5 years ago). They continued to flood in during my breakfast as fast as I could delete them.</p>

<p>The problem stemmed from the fact that network connectivity from my slicehost account had been knocked out of action – which had never happened before. I presumed this was down to the migration of slicehost over to Rackspace infrastructure, which I’d been informed of, but the network dying was probably unintended.</p>

<p>Either way, it was frustrating and I instantly decided to finally migrate away from slicehost and setup a second linode account. The funny thing is, that most of this was aided by slicehosts own documentation on configuring your server. If you’re doing little more than hosting a number of mysql / php driven sites, it is in fact really simple to switch. Here’s how I went about it, my sites all experience fairly low traffic, so I’m aware this solution might not be right for everyone.</p>

<h2 id="backup-all-your-important-data">Backup All Your Important Data</h2>

<p>First of all, you’re going to need to backup everything you have in your sites directory. For me, that’s everything under /var/www.</p>

<pre class="bash">tar -zcvf backup-feb-2012.tar.gz /var/www</pre>

<p>Next, you’ll want to do the same for your Apache sites:</p>

<pre class="bash">tar -zcvf backup-apache-feb-2012.tar.gz /etc/apache2/sites-available</pre>

<p>Finally, I took a mysqldump of my entire mysql setup:</p>

<pre class="bash">mysqldump —-all-databases -u root -p password | gzip &gt;dbbackup-feb-2012.sql.gz</pre>

<h2 id="setup-your-new-vps">Setup Your New VPS</h2>

<p>Having done that, you have pretty much everything you need to bring your server back to life as it is now. Go and grab a new vps from linode or somewhere else and set it up using the details starting from here: <a href="http://articles.slicehost.com/2010/10/18/ubuntu-maverick-setup-part-1">http://articles.slicehost.com/2010/10/18/ubuntu-maverick-setup-part-1</a> I configured my vps to have exactly the same accounts and passwords as my original vps, to make life easier for me. Once SSH and your firewall has been setup and you’re all updated, you’ll be able to transfer all the files you just created onto your fresh vps setup, using filezilla, or a direct connection between the two machines. You’ll then need to install Apache: <a href="http://articles.slicehost.com/2010/5/19/installing-apache-on-ubuntu">http://articles.slicehost.com/2010/5/19/installing-apache-on-ubuntu</a>, PHP: <a href="http://articles.slicehost.com/2010/5/19/installing-php-on-ubuntu">http://articles.slicehost.com/2010/5/19/installing-php-on-ubuntu</a> and MySQL: <a href="http://articles.slicehost.com/2011/3/10/installing-mysql-server-on-ubuntu">http://articles.slicehost.com/2011/3/10/installing-mysql-server-on-ubuntu</a></p>

<p>On your new machine, you’ll need to restore the files you backed up to /var/www.</p>

<pre class="bash">tar -xzf backup-feb-2012.tar.gz
sudo cp -r var/www/* /var/www/
sudo chown -R www-data:www-data /var/www/*
rm -rf ~/var</pre>

<p>Then the apache site files:</p>

<pre class="bash">tar -xzf backup-apache-feb-2012.tar.gz
sudo cp etc/apache2/sites-available/* /etc/apache2/sites-available/</pre>

<p>For every file that exists in the sites directory and is to be enabled, we need to enable it. You can use a2ensite for this if you like.</p>

<pre class="bash">cd /etc/apache2/sites-enabled
sudo ln -s ../sites-available/ianwootten.co.uk.conf ianwootten.co.uk.conf (for each site file)</pre>

<p>Install any apache modules you might require and restart apache. If you’re using wordpress or a php framework like me, you’ll most likely need mod_rewrite.</p>

<pre class="bash">sudo a2enmod rewrite
sudo /etc/init.d/apache2 restart</pre>

<p>You’ll then need to repopulate your new mysql install with all your old data.</p>

<pre class="bash">gunzip -c databasebackup.sql.gz | mysql -u root -p</pre>

<h2 id="configure-email">Configure Email</h2>

<p>I use msmtp to handle all my email on my server, which sends through a single gmail automailer address for my domain. If you want to send email that way do the following:</p>

<pre class="bash">sudo apt-get install msmtp ca-certificates
sudo nano /etc/msmtprc</pre>

<p>Paste the following setup in the file:</p>

<p>`defaults<br />
tls             on<br />
tls_starttls    on<br />
tls_trust_file  /etc/ssl/certs/ca-certificates.crt&lt;/p&gt;</p>
<p>account default<br />
host            smtp.gmail.com<br />
port            587<br />
auto_from       off<br />
auth            on<br />
user            automailer@somedomain.com<br />
password        mymailpass<br />
from            automailer@somedomain.com<br />
maildomain      somedomain.com<br />
logfile		/var/log/msmtp.log`

<pre class="bash">sudo chmod 0644 /etc/msmtprc</pre>

You can test whether it’s working using a the command as:

<pre class="bash">echo -e "Subject: A Test Email\r\n\r\nThis is a test" |msmtp --debug --from=default -t mymail@gmail.com</pre>

## Configure DNS

You need to configure how your vps is going to handle particular requests for various domains. You’ve probably had to do this already with your current vps, so just copy the entries through whatever management system your new host provides. For sites that have a fairly simple setup, your host may provide a simple set of default entries to use, or you can clone entries that have the same setup as each other.

We’re now at the point where we have a complete copy of our vps up and running, and the vps knows how to handle requests for domains, however currently our domain registrar points to our old vps, so the requests will never reach our new server. Head to your domain registrar and change the entries for a single domain, to point to your new vps (ns1.linode.com, ns2.linode.com etc). Now sit and wait patiently….Once that domain has propagated correctly (ping it to see if has a new or old ip), and you’re happy your site is working as expected, go ahead and change all of your domains dns entries to the ip address of your new vps.

## Relax&#8230;

All in all, I don&#8217;t think this took me more than a couple of hours working with the terminal open. I certainly didn&#8217;t worry about migrating in the way I have done previously. As I opted for a uk datacentre with linode, a side effect of the change is all my sites are much much faster &#8211; and a better setup with linode is in fact cheaper than slicehost. I left my slicehost account running for an entire week prior to shutting it down yesterday &#8211; just in case&#8230;
</p>

<div class="entry_content">Tagged <a href="/tag/dns">dns</a>, <a href="/tag/gmail">gmail</a>, <a href="/tag/linode">linode</a>, <a href="/tag/msmtp">msmtp</a>, <a href="/tag/server">server</a>, <a href="/tag/slicehost">slicehost</a>,  | <a href="/2012/03/01/how-to-switch-your-vps-in-2-hours/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/02/16/wheres-my-full-stack-payment-service">Where&#8217;s my Full Stack Payment Service?</a></h1>
<div class="author_meta">16 Feb 2012</div>
<p>Unless you’ve been living under a rock, you’ll realise that there’s an uprising against paypal amongst developers. Most of this stems from the multitude of <a href="http://www.huffingtonpost.com/2011/12/06/paypal-to-regretsy-sorry-_n_1132679.html">crazy requirements</a> they put upon sellers and the locks they can put upon your account without notice.</p>

<p>This in part has led to a number of payment alternatives cropping up. Here in the UK for instance, you have Google checkout and checkout by Amazon pitching up against paypal. None of these solutions are ideal though if you’re looking to make say, a service that bills on a monthly basis.</p>

<p>Enter the subscription billing tools – there’s <a href="http://recurly.com/">recurly</a>, <a href="http://chargify.com/">Chargify</a> and <a href="http://saasy.com/">Saasy</a>, to name 3. All of these go some way to ease the management of customer subscriptions. This is great if you have an established banking history as a business and are able to get hold of a merchant account. Not so great for me – an independent developer with neither of those.</p>

<p>Enter <a href="https://stripe.com/">Stripe</a>, a full-stack payment processor for developers which has no requirement on merchant accounts or gateways. Integration with your own website is as simple as pasting in some javascript. Sounds great…..Except I need to be in the US to use it. *Facepalm*. I even had beta access to stripe in it’s infancy and just had to smile at my invitation code.</p>

<p>Recently here in the UK, <a href="http://gocardless.com">Go Cardless</a> has appeared with an interesting model, based around the use of direct debits to set up subscriptions and make payments. That strikes me as a little weird from a customer point of view. I’m ok paying my gas by direct debit, but would I be ok paying for a piece of software? Given it’s unusual for a website to bill this way, I’d argue most people wouldn’t be.</p>

<p>Unfortunately for us independent developers in the UK, Go Cardless really is our best option until Stripe or some other full stack offering lands here. I know Stripe are supposedly working hard on doing so, but payments are at an incredibly frustrating point here right now.</p>


<div class="entry_content">Tagged <a href="/tag/go cardless">go cardless</a>, <a href="/tag/payments">payments</a>, <a href="/tag/stripe">stripe</a>, <a href="/tag/the little guy">the little guy</a>,  | <a href="/2012/02/16/wheres-my-full-stack-payment-service/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/01/23/new-adventures-2012-self-help-for-web-designers">New Adventures 2012 &#8211; Self Help for Web Designers</a></h1>
<div class="author_meta">23 Jan 2012</div>
<p>Last week, like many others working on the web, I took the trip to Nottingham for <a href="http://2012.newadventuresconf.com/">New Adventures 2012</a>. I’d seen the wonderful praise dished out for it last year and felt like I wanted to see what it was all about first hand. </p>

<p>I’ve learnt from experience that the most important part of any conference is not the talks or speakers involved, but the community around it and therefore I headed up the night before to ensure I didn’t miss a thing.</p>

<p>Colly and his team had done a lovely job of organising enough to keep us busy what with bowling, screenprinting, fr00tball, the after party and of course the main event.</p>

<p><a href="http://www.ianwootten.co.uk/wp-content/uploads/2012/01/20120119_092906_small.jpg"><img src="http://www.ianwootten.co.uk/wp-content/uploads/2012/01/20120119_092906_small-1024x768.jpg" alt="" title="The Albert Hall" width="640" height="480" class="alignnone size-large wp-image-515" /></a></p>

<p>Despite not actually branding myself as a web designer, it was great to feel welcomed and able to chat one on one with others about our day to day work. Dan Mall’s talked helped somewhat here, forcing introductions with everyone around me. I’m pretty much work in solitary confinement as a developer and to discuss the thoughts and ideas I have with other like minded creatives is always welcome.</p>

<p>During a dinner following the conference, another dev commented that the most of the presentations weren’t specific to web design. They were in fact so abstract, that it was more a “Self Help Class for Web Designers”. I pretty much agree with this. But that’s with a caveat – what else do you attend these presentations for? NA Conf is there to share, inspire and enable designers to be better designers. I want to leave giddy eyed with possibilities. Remember there are workshops too for specifics…</p>

<p>After the whole conference, I feel like there’s a whole lot more I could do to better myself at my craft. Hopefully over the course of the year I’ll do something about it. Most of the notes I made are to this effect too and I’m sure I’ll take away something different each time I look at them.</p>

<p>There’s only so much that can be covered in 45 mins, and for me I want to see a speaker paint me the big picture. After NAConf, I’ve got a whole bunch of big pictures to get through.</p>


<div class="entry_content">Tagged <a href="/tag/design">design</a>, <a href="/tag/naconf">naconf</a>, <a href="/tag/web design">web design</a>,  | <a href="/2012/01/23/new-adventures-2012-self-help-for-web-designers/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2012/01/12/goodbye-1-1">Goodbye 1 &#038; 1</a></h1>
<div class="author_meta">12 Jan 2012</div>
<p>I just sent the following email to 1 &#038; 1′s billing department. I’ve been with them for coming up to 7 years now and they were, when I first used them, the only registraar I knew about and I was really happy. </p>

<p>As the number of domains I own has grown, their account admin has become really totally useless to manage them all. I recieved a payment request out of the blue today and it tipped me over the edge.</p>

<blockquote>
  <blockquote>
    <p>We contacted you regarding a declined payment or an expired credit/debit card and have not yet heard back from you.<br />
Our records indicate that there is an unpaid balance in your 1&#038;1 customer account no.: K####### as listed below.</p>
  </blockquote>

  <p>Firstly – No you didn’t.</p>

  <p>Secondly – It would be far more useful telling me which domain name in my account a payment demand is in reference to rather than my account number, as I have more than 1 domain with you.</p>

  <p>Thirdly – The steps you’ve listed here to find my payment details miss steps and references links that don’t exist.</p>

  <p>Fourthly – Threatening action when you haven’t actually sent a primary payment request email is rude, forceful and obnoxious.</p>

  <blockquote>
    <p>Please be aware that if this matter is not resolved, you may be sent to a debt collection agency. If the account is sent to a debt collection agency a £15.00 &gt; charge will be added to the unpaid balance.</p>
  </blockquote>

  <p>I’ve decided to take all of my business elsewhere at the earliest opportunity. I’d hope you’d take heed of these comments and pay your other longstanding customers the respect they deserve.</p>
</blockquote>

<div class="entry_content">Tagged <a href="/tag/customer service">customer service</a>, <a href="/tag/domains">domains</a>,  | <a href="/2012/01/12/goodbye-1-1/#disqus_thread">Leave a comment</a></div>
</div>



<div class="post">
<h1><a href="/2011/11/02/pagination-in-couchdb-apps">Pagination in CouchDB Apps</a></h1>
<div class="author_meta">02 Nov 2011</div>
<p>I’ve been working on some fun little node.js / couchdb projects of late. Given the fact I don’t use either as part of my work, I’ve spent some downtime experimenting and slowly iterating my approaches as I learn best practice.</p>

<p>I hit what I consider to be a fairly frustrating hurdle that couchdb threw up that I’ve been blissfully unaware of through all my couchdb dev. When it came to doing pagination it turns out <a href="http://guide.couchdb.org/draft/recipes.html#pagination" title="CouchDB Pagination Recipe">I’ve always been doing it the “bad” way</a>. Oh, well that’s upsetting.</p>

<h2 id="the-wrong-way">The Wrong Way</h2>

<p>My “slow” approach has always been to take the page no as a argument in the url, generating “skip” and “limit” variables to be used as parameters to my store. So for example, if I wanted to have the 2nd page of my app showing 10 items:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">skip</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pageno</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="p">()</span> <span class="o">:</span> <span class="p">((</span><span class="nx">pageno</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span></code></pre></div>

<div class="highlight"><pre><code class="bash">curl -X GET http://127.0.0.1:5984/stuff/_design/stuff/_view/by-name?skip<span class="o">=</span>10<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span>10</code></pre></div>

<p>It turns out, that although you might think you’re starting at a particular result, CouchDB still starts at the first result, due to the way the view is created from the b-tree index, couchDB just surpresses the results you skip. This isn’t good news when you’re trying to skip say, 10000 results.</p>

<h2 id="the-suggested-way">The Suggested Way</h2>

<p>The suggested solution is to perform requests and instead of using a “skip” parameter, keep track of the startkey at which the next page begins. This is possible, by requesting a page 1 item longer than that of the number of items on a page and using the key of the result in any requests. So now, for a first page my query is:</p>

<div class="highlight"><pre><code class="bash">curl -X GET http://127.0.0.1:5984/stuff/_design/stuff/_view/by-name?limit<span class="o">=</span>11</code></pre></div>

<p>Returning something like:</p>

<div class="highlight"><pre><code class="json"><span class="p">{</span><span class="nt">&quot;total_rows&quot;</span><span class="p">:</span><span class="mi">17</span><span class="p">,</span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;rows&quot;</span><span class="p">:[</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;8177bf155b952652129836a5d354b30e&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Ian Wootten&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;bae2c490c70480aec7096d79e1e3bfc3&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Isambard Kingdom Brunel&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;eaae74cfbe5cd13ea6b50dfd090827ca&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Christopher Columbus&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;491e68b08d73256f060ebf4b8e063e1c&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Elizabeth Fry&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;b45d8a7b9edee9ca66ac0860196f4504&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Edward Jenner&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;8a4d3f46885701ffcc7532aeac7a5ae9&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Florence Nightingale&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;71e6534c17429eca2cd9450cfc95c6bb&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Samuel Pepys&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;6cbad847f0ae959b281b471a72d60587&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Pocahontas&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;e5b026ec5c92c20f1575a2901defe14e&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Mary Seacole&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;84a371a7b8414237fad1b6aaf68cd16a&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;George Stephenson&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">},</span>
  <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;321aeb36e20d62660eb0d03c9fcd27b2&quot;</span><span class="p">,</span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;Joe Bloggs&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">}</span>
<span class="p">]}</span></code></pre></div>

<p>From the 11th returned result, I have the key “Joe Bloggs” – which can be used as a startkey arg to couch to obtain my second page. If we have duplicate keys, it is also neccessary to keep tabs on the last document’s id and supply as a startkey_docid arg in order to correctly page through everything.</p>

<p>What personally I dislike about the suggested approach, is the inability to create simple requests to arbritrary pages, even with low numbers. We always need to follow a path of links from the first page in order to view particular results. CouchDB’s response is “Not even Google is doing that!”, which is kind of weak to me. I want nice clean urls ala myapp.com/page/2 or myapp.com?page=2.</p>

<p>In fact, such a suggested approach only really allows us to have a single “more” type link in order to fetch results. Passing a startkey as part of a url param eg /page/321aeb36e20d62660eb0d03c9fcd27b2 just sounds (and looks) plain nasty and isn’t very good from a UX point of view for any users we may have.</p>

<p>At the moment, clean tangible page urls (the right way) are only possible using custom middleware. I’ve yet to find anything suitable for <a href="http://nodejs.org">node.js</a>. I intend to investigate how to cache document keys for low numbered pages as a separate db in order to produce a solution for my current project and I hope to write a later post detailing how I’ve got on.</p>


<div class="entry_content">Tagged <a href="/tag/articles">articles</a>, <a href="/tag/couchdb">couchdb</a>, <a href="/tag/nodejs">nodejs</a>,  | <a href="/2011/11/02/pagination-in-couchdb-apps/#disqus_thread">Leave a comment</a></div>
</div>



<div class="pagination">

  <a href="/page/2" class="previous">Previous</a>

<span class="page_number ">Page: 3 of 28</span>

  <a href="/page/4" class="next">Next</a>

</div>

      <footer>
        <div class="footer-about">
          I'm a Web Developer  working at <a href="http://niftydigits.com">Nifty Digits</a> in Cardiff, UK. Here, I enjoy talking code - mostly javascript. I'm <a href="http://twitter.com/iwootten">@iwootten</a> on twitter.
        </div>
      </footer>
    </div>
   <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ianwootten'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
