<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Ian Wootten - Web Developer, Cardiff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/fonts/open-sans.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-263865-2', 'ianwootten.co.uk');
      ga('send', 'pageview');

    </script>
</head>
<body>

<div class="container blog">
    <header>
      <nav>
      <ul class="nav">
        <li><a class="blog active" href="/">Blog</a></li>
        <li><a class="javascript " href="/category/javascript">Javascript</a></li>
        <li><a class="web-apps " href="/category/web-apps">Web Apps</a></li>
        <li><a class="about" href="/about">About</a></li>
        <li><a class="contact" href="/contact">Contact</a></li>
      </ul>
      </nav>
      <div class="clear"></div>
    </header>

      
        <div class="post">
          <h1><a href="/2008/01/05/decrypting-filezilla-passwords-with-php">Decrypting Filezilla Passwords with PHP</a></h1>
      <div class="author_meta">05 Jan 2008</div>

          <p>One of the most frustrating things I find in managing a number of websites is that I&#8217;m always forgetting passwords. The version of Filezilla I&#8217;m running however makes it easy to remember them again through its use of weak XOR encryption and a the key being hard coded into the software. I&#8217;ve used a program previously called the <a href="http://www.devpro.it/filezilla_pr/">Filezilla Password Recover</a>, but it turns out that this is also extremely easy to extract them using a simple PHP script. The following code makes use of the nice XML parsing in PHP5 and a decryption function I found over <a href="http://www.thinksheep.nl/php-filezilla-passwords-ophalen">here</a>. I&#8217;ve added some comments to roughly describe what is going on.</p>
<p>Note: Apparently this encryption has been dropped from version 3 with absolutely no encryption featured at all, that&#8217;ll make my job easier now.</p>
<div class='hljs'><pre><code class='php'><span class="hljs-variable">$filezilla_password_file</span> = <span class="hljs-string">"FileZilla.xml"</span>;

<span class="hljs-variable">$xml</span> = file_get_contents(<span class="hljs-variable">$filezilla_password_file</span>);

<span class="hljs-variable">$simple_xml</span> = simplexml_load_string(<span class="hljs-variable">$xml</span>);

<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$simple_xml</span>-&gt;Sites-&gt;Site <span class="hljs-keyword">as</span> <span class="hljs-variable">$site</span>)
{
    <span class="hljs-variable">$attributes</span> =  <span class="hljs-variable">$site</span>-&gt;attributes();

    <span class="hljs-keyword">print</span> <span class="hljs-string">"Site: "</span>.<span class="hljs-variable">$attributes</span>-&gt;Name.<span class="hljs-string">"\n"</span>;
    <span class="hljs-keyword">print</span> <span class="hljs-string">"User: "</span>.<span class="hljs-variable">$attributes</span>-&gt;User.<span class="hljs-string">"\n"</span>;
    <span class="hljs-keyword">print</span> <span class="hljs-string">"Encrypted Pass: "</span>.<span class="hljs-variable">$attributes</span>-&gt;Pass.<span class="hljs-string">"\n"</span>;
    <span class="hljs-keyword">print</span> <span class="hljs-string">"Unencrypted Pass:"</span>.decryptPass((string)<span class="hljs-variable">$attributes</span>-&gt;Pass).<span class="hljs-string">"\n\n"</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decryptPass</span><span class="hljs-params">(<span class="hljs-variable">$pass</span>)</span>
</span>{
        <span class="hljs-comment">// Encryption Key for FileZilla 2 Passwords</span>
    <span class="hljs-variable">$key</span> = <span class="hljs-string">"FILEZILLA1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;

    <span class="hljs-comment">// Find the offset position in the key for this pass</span>
    <span class="hljs-variable">$pos</span>=(strlen(<span class="hljs-variable">$pass</span>)/<span class="hljs-number">3</span>) % strlen(<span class="hljs-variable">$key</span>);
    <span class="hljs-variable">$decrypt</span> = <span class="hljs-string">''</span>;

    <span class="hljs-variable">$t</span>=<span class="hljs-number">0</span>;

    <span class="hljs-comment">//Loop through each 3rd of the password</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span> &amp;lt; strlen(<span class="hljs-variable">$pass</span>) / <span class="hljs-number">3</span>;<span class="hljs-variable">$i</span>++) {

        <span class="hljs-comment">//Get 3 characters, remove the 0 at the</span>
    <span class="hljs-comment">//front to get ASCII code to represent the character</span>
    <span class="hljs-variable">$num</span> = substr(<span class="hljs-variable">$pass</span>,<span class="hljs-variable">$i</span> * <span class="hljs-number">3</span>,<span class="hljs-number">3</span>);

    <span class="hljs-keyword">if</span> (substr(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) {
        <span class="hljs-variable">$num</span> = substr(<span class="hljs-variable">$num</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);
    }

    <span class="hljs-comment">//Get the ascii code of the unencrypted character</span>
    <span class="hljs-comment">//by performing XOR against current ASCII and key</span>
    <span class="hljs-comment">//before converting back and adding to decrypted pass</span>
        <span class="hljs-variable">$t</span> = <span class="hljs-variable">$num</span> ^ ord(<span class="hljs-variable">$key</span>[(<span class="hljs-variable">$i</span> + <span class="hljs-variable">$pos</span>) % strlen(<span class="hljs-variable">$pass</span>)]);
         <span class="hljs-variable">$decrypt</span> .= chr(<span class="hljs-variable">$t</span>);

    }

    <span class="hljs-comment">// Return the decrypted pass</span>
       <span class="hljs-keyword">return</span> <span class="hljs-variable">$decrypt</span>;
}</code></pre></div>

          <div class="entry_content">Tagged
              
                
                <a href="/tag/decryption">decryption</a>,
                
                <a href="/tag/filezilla">filezilla</a>,
                
                <a href="/tag/PHP">PHP</a>,
                
              
              | <a href="2008/01/05/decrypting-filezilla-passwords-with-php/#disqus_thread">Leave a comment</a>
          </div>
        </div>
      

      <div class="pagination">
          
          <span class="page_number ">Page: 1 of 1</span>

          
      </div>
    <footer>
      <div class="footer-about">
        I'm a Web Developer  working at <a href="http://niftydigits.com">Nifty Digits</a> in Cardiff, UK. Here, I enjoy talking code - mostly Python/Javascript. I'm <a href="http://twitter.com/iwootten">@iwootten</a> on twitter.
      </div>
    </footer>
  </div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'ianwootten'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
</body>
</html>

