<!DOCTYPE html>
<html lang="en" class="motion-safe:scroll-smooth 2xl:text-[20px]">
	<head>
		<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Blog rolling with CouchDB, Express and Node.js â€” Ian Wootten</title>
<meta name="robots" content="index,follow" />
<meta property="og:title" content="Blog rolling with CouchDB, Express and Node.js" />
<meta property="og:url" content="https://www.ianwootten.co.uk/2011/02/07/blog-rolling-with-couchdb-express-and-node-js/" />
<meta property="og:type" content="article" />
<link rel="canonical" href="https://www.ianwootten.co.uk/2011/02/07/blog-rolling-with-couchdb-express-and-node-js/" />


<!-- Or Google Fonts -->

<meta name="google-site-verification" content="orcPxI47GSa-cRvY11tUe6iGg2IO_RPvnA1q95iEM3M">



<script defer data-domain="ianwootten.co.uk" src="https://analytics.niftydigits.com/js/plausible.js"></script>

<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="mask-icon" href="/favicon.svg" color="#8D46E7">


	<link rel="stylesheet" href="/assets/_...page_.0987525b.css" />
<link rel="stylesheet" href="/assets/_slug_.7cc5c313.css" />
<link rel="stylesheet" href="/assets/index.a49322ed.css" /><script type="module">class c extends HTMLElement{connectedCallback(){this.videoId=this.getAttribute("videoid");let e=this.querySelector(".lty-playbtn");if(this.playLabel=e&&e.textContent.trim()||this.getAttribute("playlabel")||"Play",this.style.backgroundImage||(this.posterUrl=`https://i.ytimg.com/vi/${this.videoId}/hqdefault.jpg`,c.addPrefetch("preload",this.posterUrl,"image"),this.style.backgroundImage=`url("${this.posterUrl}")`),e||(e=document.createElement("button"),e.type="button",e.classList.add("lty-playbtn"),this.append(e)),!e.textContent){const t=document.createElement("span");t.className="lyt-visually-hidden",t.textContent=this.playLabel,e.append(t)}this.addEventListener("pointerover",c.warmConnections,{once:!0}),this.addEventListener("click",t=>this.addIframe())}static addPrefetch(e,t,o){const n=document.createElement("link");n.rel=e,n.href=t,o&&(n.as=o),document.head.append(n)}static warmConnections(){c.preconnected||(c.addPrefetch("preconnect","https://www.youtube-nocookie.com"),c.addPrefetch("preconnect","https://www.google.com"),c.addPrefetch("preconnect","https://googleads.g.doubleclick.net"),c.addPrefetch("preconnect","https://static.doubleclick.net"),c.preconnected=!0)}addIframe(){const e=new URLSearchParams(this.getAttribute("params")||[]);e.append("autoplay","1");const t=document.createElement("iframe");t.width=560,t.height=315,t.title=this.playLabel,t.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",t.allowFullscreen=!0,t.src=`https://www.youtube-nocookie.com/embed/${encodeURIComponent(this.videoId)}?${e.toString()}`,this.append(t),this.classList.add("lyt-activated"),this.querySelector("iframe").focus()}}customElements.define("lite-youtube",c);class a extends HTMLElement{videoId;static preconnected=!1;connectedCallback(){this.videoId=encodeURIComponent(this.dataset.id),this.addEventListener("pointerover",a.warmConnections,{once:!0}),this.addEventListener("click",e=>this.addIframe(e))}static addPrefetch(e,t){const o=document.createElement("link");o.rel=e,o.href=t,document.head.append(o)}static warmConnections(){a.preconnected||(a.addPrefetch("preconnect","https://player.vimeo.com"),a.addPrefetch("preconnect","https://i.vimeocdn.com"),a.addPrefetch("preconnect","https://f.vimeocdn.com"),a.addPrefetch("preconnect","https://fresnel.vimeocdn.com"),a.preconnected=!0)}addIframe(e){if(this.classList.contains("ltv-activated"))return;e.preventDefault(),this.classList.add("ltv-activated");const t=encodeURIComponent(this.dataset.t||"0m"),o=new URLSearchParams(this.dataset.params||[]),n=document.createElement("iframe");n.width="640",n.height="360",n.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",n.allowFullscreen=!0,n.src=`https://player.vimeo.com/video/${this.videoId}?${o.toString()}#t=${t}`,this.append(n)}}customElements.define("lite-vimeo",a);
</script>
<script>!(function(w,p,f,c){c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.7.3 - MIT builder.io */
!function(t,e,n,i,r,o,a,d,s,c,p,l){function u(){l||(l=1,"/"==(a=(o.lib||"/~partytown/")+(o.debug?"debug/":""))[0]&&(s=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(w,1e4),e.addEventListener("pt0",f),r?h(1):n.serviceWorker?n.serviceWorker.register(a+(o.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):w())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.setAttribute("style","display:block;width:0;height:0;border:0;visibility:hidden"),c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.7.3":"sandbox-sw.html?"+Date.now()),e.body.appendChild(c)}function w(t,n){for(f(),t=0;t<s.length;t++)(n=e.createElement("script")).innerHTML=s[t].innerHTML,e.head.appendChild(n);c&&c.parentNode.removeChild(c)}function f(){clearTimeout(d)}o=t.partytown||{},i==t&&(o.forward||[]).map((function(e){p=t,e.split(".").map((function(e,n,i){p=p[i[n]]=n+1<i.length?"push"==i[n+1]?[]:p[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);</script></head>

	<body class="antialiased text-gray-900 dark:text-slate-300 tracking-tight bg-white dark:bg-slate-900">
		<header class="sticky top-0 z-40 flex-none mx-auto w-full bg-white md:bg-white/90 dark:bg-slate-900 dark:md:bg-slate-900/90 md:backdrop-blur-sm border-b dark:border-b-0">
	<div class="py-3 px-3 mx-auto w-full md:flex md:justify-between max-w-6xl md:px-4">
		<div class="flex justify-between">
			<a class="flex items-center" href="/">
				<span class="self-center ml-2 text-2xl font-extrabold text-gray-900 whitespace-nowrap dark:text-white">
	ðŸ’»&nbsp;&nbsp;Ian Wootten</span>
			</a>
			<div class="flex items-center md:hidden">
				<button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme>
	<svg viewBox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg>
</button>
				<button type="button" class="ml-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center transition" aria-label="Toggle Menu" data-aw-toggle-menu>
	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:menu"><g class="icon-tabler" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8h16"/><path d="M4 16h16"/></g></svg>
</button>
			</div>
		</div>
		<nav class="items-center w-full md:w-auto hidden md:flex text-gray-600 dark:text-slate-200 h-screen md:h-auto" aria-label="Main navigation" id="menu">
			<ul class="flex flex-col pt-8 md:pt-0 md:flex-row md:self-center w-full md:w-auto collapsed text-xl md:text-base">
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="/blog/">Blog</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="/about/">About</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="/work-with-me/">Work With Me</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://niftydigits.gumroad.com/">Products
					</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://newsletter.ianwootten.co.uk">Subscribe
					</a>
				</li>
				<li class="md:hidden">
					<a class="font-bold hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://github.com/iwootten">Github
					</a>
				</li>
			</ul>
			<div class="md:self-center flex items-center mb-4 md:mb-0 ml-2">
				<div class="hidden items-center md:flex">
					<button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme>
	<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg>
</button>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS Feed" href="/rss.xml">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:rss"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"/></g></svg>
					</a>
					<a href="https://github.com/iwootten" class="inline-block text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5" aria-label="Ian's Github">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-github"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
					</a>
				</div>
			</div>
		</nav>
	</div>
</header><main>
		<section class="py-8 sm:py-16 lg:py-20 mx-auto">
	<article>
		<header>
			<p class="max-w-3xl mx-auto text-center">
				<time datetime="2011-02-07T00:00:00.000Z">Feb 7, 2011</time> ~ 6 min read
			</p>
			<h1 class="px-4 sm:px-6 max-w-3xl mx-auto text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-8 font-heading">
				Blog rolling with CouchDB, Express and Node.js
			</h1>
			<div class="container text-center mx-auto px-8 sm:px-6 max-w-3xl mt-8">
				<ul class="text-sm">
			<li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/couchdb/">couchdb</a>
				</li><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/expressjs/">expressjs</a>
				</li><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/mongdb/">mongdb</a>
				</li><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/node/">node</a>
				</li><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/nodejs/">nodejs</a>
				</li>
		</ul>
			</div>
			
		</header>
		<div class="container mx-auto px-6 sm:px-6 max-w-3xl prose prose-lg lg:prose-xl dark:prose-invert dark:prose-headings:text-slate-300 prose-md prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-primary-600 dark:prose-a:text-primary-400 prose-img:rounded-md prose-img:shadow-lg mt-8">
			<p>Over the last little while, Iâ€™ve been doing a lot of playing with <a href="http://nodejs.org">Node.js</a>, mostly to run data collection scripts. Last week, I started following <a href="http://howtonode.org/express-mongodb">Ciaran Jessupâ€™s tutorial</a> on getting started with <a href="http://nodejs.org">node.js</a>, <a href="http://github.com/visionmedia/express">Express</a> and <a href="http://www.mongodb.org/">mongoDB</a>. Express acts as a framework to node.js, allowing you to work in a familiar mvc format in a not so familar <a href="http://en.wikipedia.org/wiki/JavaScript">server side language</a>. I hit a few problems along the way in the tutorial, so I thought Iâ€™ve list a few of my findings here. I also wanted to make use of my preferred flavour of nosql â€“ <a href="http://couchdb.apache.org/">couchdb</a> with express, which proved extremely easy to port the mongo model over to it. I hope someone out there finds this useful as Iâ€™ve yet to find a vast community using couchdb/express.</p>
<p>First things first, youâ€™ll want to install <a href="http://nodejs.org">Node</a> and <a href="http://npmjs.org">npm</a> (the node package manager) in order to be able to easily install node packages. Youâ€™ll also probably find it handy to have the <a href="http://howtonode.org/express-mongodb">original tutorial open</a> alongside this one. Iâ€™ve been using the latest versions of node (0.3.7) and npm (0.2.17) at the time of writing.</p>
<p>Once thatâ€™s done, grab copies of the packages that weâ€™ll be using:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">npm install express</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">npm install jade</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">npm install sass</span></span></code></pre>
<p>If you want to use couchdb, then make sure you have it installed â€“ grab it over <a href="http://www.couchone.com/get">here</a> and then install the package for talking to node.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">npm install cradle</span></span></code></pre>
<p>The first hurdle I found was that the way in which that express is called has changed a little.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> express </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'express'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> app </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> express.</span><span style="color: #D2A8FF">createServer</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">configure</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(){</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">methodOverride</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">bodyDecoder</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">logger</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">    res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Hello World'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">);</span></span></code></pre>
<p>Then by saving to a file called app.js and calling using:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">node app.js</span></span></code></pre>
<p>Once thatâ€™s done. You can then visit 127.0.0.1:3000 in your browser to see a rivetting message!</p>
<p>After creating folder beneath our original app.js in which to put views, you can use the original <a href="http://howtonode.org/express-mongodb/articleprovider-memory.js">article provider file</a> and the updated app.js below in order to have an app with a few articles shown.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> express </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'express'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> ArticleProvider </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'./articleprovider-memory'</span><span style="color: #C9D1D9">).ArticleProvider;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> app </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> express.</span><span style="color: #D2A8FF">createServer</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">configure</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(){</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">methodOverride</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">bodyDecoder</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">logger</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> articleProvider</span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ArticleProvider</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">  articleProvider.</span><span style="color: #D2A8FF">findAll</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">docs</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">    res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'sys'</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">inspect</span><span style="color: #C9D1D9">(docs));</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">);</span></span></code></pre>
<p>Now when you re-run, youâ€™ll see 3 separate articles. Oooh fancy!</p>
<p>Next I hit my first hurdle. Express no longer uses the HAML HTML template language and instead uses JADE by default. This requires converting the HAML templates across to their equivalent JADE counterparts. Basically, this is as simple as dropping the â€˜%â€™ from the beginning of each line (I also replaced braces with brackets in later templates).</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #7EE787">html</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">head</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">title</span><span style="color: #79C0FF">=</span><span style="color: #C9D1D9"> title</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">link</span><span style="color: #79C0FF">(rel:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">'stylesheet'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">href:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">'</span><span style="color: #C9D1D9">/</span><span style="color: #79C0FF">style.css'</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">body</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">#wrapper</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">!=</span><span style="color: #C9D1D9"> body</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #7EE787">h1</span><span style="color: #79C0FF">=</span><span style="color: #C9D1D9"> title</span></span>
<span class="line"><span style="color: #79C0FF">#articles</span></span>
<span class="line"><span style="color: #C9D1D9">  - each article </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> articles</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.article</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.created_at=</span><span style="color: #C9D1D9"> article.created_at</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.title=</span><span style="color: #C9D1D9"> article.title</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.body=</span><span style="color: #C9D1D9"> article.body</span></span></code></pre>
<p>The app.js now becomes:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> express </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'express'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> app </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> express.</span><span style="color: #D2A8FF">createServer</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">configure</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(){</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">set</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'view engine'</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">'jade'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">set</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'views'</span><span style="color: #C9D1D9">, __dirname </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'/views'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">methodOverride</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">bodyDecoder</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">logger</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(app.router);</span></span>
<span class="line"><span style="color: #C9D1D9">  app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">compiler</span><span style="color: #C9D1D9">({ src: __dirname </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'/views'</span><span style="color: #C9D1D9">, enable: [</span><span style="color: #A5D6FF">'sass'</span><span style="color: #C9D1D9">] }));</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> ArticleProvider </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'./articleprovider-memory'</span><span style="color: #C9D1D9">).ArticleProvider;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">,</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">  articleProvider.</span><span style="color: #D2A8FF">findAll</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">docs</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">    res.</span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'blogs_index.jade'</span><span style="color: #C9D1D9">, {</span></span>
<span class="line"><span style="color: #C9D1D9">      locals: {</span></span>
<span class="line"><span style="color: #C9D1D9">        title: </span><span style="color: #A5D6FF">'Blog'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        articles: docs</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    });</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/*.css'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">,</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(req.params[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">] </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'.css.sass'</span><span style="color: #C9D1D9">, { layout: </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9"> });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">);</span></span></code></pre>
<p>Youâ€™ll notice that here we enable the CSS compiler sass and HTML compiler jade. If you download the original <a href="http://howtonode.org/express-mongodb/views/style.css.sass">sass CSS template</a> into your views folder, you can now restart the app and inspect the fruits of your labour. The CSS shouldnâ€™t actually sit in the views folder, according to the creator of Express, and should instead should be compiled with the sass package itself. Iâ€™ve yet to discover the correct way of doing this. To request a stylesheet in the view, we need to do the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #7EE787">html</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">head</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">title</span><span style="color: #79C0FF">=</span><span style="color: #C9D1D9"> title</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">link</span><span style="color: #79C0FF">(rel:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">'stylesheet'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">href:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">'</span><span style="color: #C9D1D9">/</span><span style="color: #79C0FF">style.css'</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">body</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">#wrapper</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">!=</span><span style="color: #C9D1D9"> body</span></span></code></pre>
<p>If you reload now and visit <a href="http://127.0.0.1:3000">127.0.0.1:3000</a> you should see your posts with a little more style.</p>
<p>Creating a form for new posts looks like this:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #7EE787">h1</span><span style="color: #79C0FF">=</span><span style="color: #C9D1D9"> title</span></span>
<span class="line"><span style="color: #7EE787">form</span><span style="color: #79C0FF">( method</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'post'</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">div</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">div</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">span</span><span style="color: #C9D1D9"> Title :</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">input</span><span style="color: #79C0FF">(type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">'text'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'title'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'editArticleTitle'</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">div</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">span</span><span style="color: #C9D1D9"> Body :</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">textarea</span><span style="color: #79C0FF">( name</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'body'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">rows</span><span style="color: #C9D1D9">= </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'editArticleBody'</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">#editArticleSubmit</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">input</span><span style="color: #79C0FF">( type</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'submit'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">= </span><span style="color: #A5D6FF">'Send'</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">)</span></span></code></pre>
<p>And the new app.js routes are as follows:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/blog/new'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">,</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'blog_new'</span><span style="color: #C9D1D9">, {</span></span>
<span class="line"><span style="color: #C9D1D9">    locals: {</span></span>
<span class="line"><span style="color: #C9D1D9">      title: </span><span style="color: #A5D6FF">'New Post'</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/blog/new'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">,</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">  articleProvider.</span><span style="color: #D2A8FF">save</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">    title: req.</span><span style="color: #D2A8FF">param</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'title'</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">    body: req.</span><span style="color: #D2A8FF">param</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'body'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  }, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">docs</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    res.</span><span style="color: #D2A8FF">redirect</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>In order to add persistence using mongodb, nothing changes in the original model file, <a href="http://howtonode.org/express-mongodb/articleprovider-mongodb.js">so go ahead and use that</a>. Youâ€™ll need to have installed the package â€˜mongodbâ€™ if youâ€™d like to try out using it though and update your instantiation of the articleprovider class by supplying a port number to which mongo is installed.</p>
<h1 id="adding-couchdb-persistence">Adding CouchDB Persistence</h1>
<p>Here, I took my own angle on the tutorial and decided to give attempting to make my own persistence model using couchdb a go. It proved to be extremely easy, given the JSON representation and HTTP/GET method of access already built in to it.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> cradle </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'cradle'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D2A8FF">ArticleProvider</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">host</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">port</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.connection</span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> (cradle.Connection)(host, port, {</span></span>
<span class="line"><span style="color: #C9D1D9">    cache: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    raw: </span><span style="color: #79C0FF">false</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.db </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.connection.</span><span style="color: #D2A8FF">database</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'articles'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">ArticleProvider</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">findAll</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">callback</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.db.</span><span style="color: #D2A8FF">view</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'articles/all'</span><span style="color: #C9D1D9">,</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">result</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">( error ){</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">callback</span><span style="color: #C9D1D9">(error)</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9">{</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> docs </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"><span style="color: #C9D1D9">        result.</span><span style="color: #D2A8FF">forEach</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">row</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">          docs.</span><span style="color: #D2A8FF">push</span><span style="color: #C9D1D9">(row);</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">callback</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, docs);</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    });</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">ArticleProvider</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">findById</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">id</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">callback</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.db.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(id, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">result</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">( error ) </span><span style="color: #D2A8FF">callback</span><span style="color: #C9D1D9">(error)</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">callback</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, result)</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">ArticleProvider</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">save</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">articles</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">callback</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">( </span><span style="color: #FF7B72">typeof</span><span style="color: #C9D1D9">(articles.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9">)</span><span style="color: #FF7B72">==</span><span style="color: #A5D6FF">"undefined"</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">      articles </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [articles];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9">( </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">;i</span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> articles.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9">;i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9"> ) {</span></span>
<span class="line"><span style="color: #C9D1D9">      article </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> articles[i];</span></span>
<span class="line"><span style="color: #C9D1D9">      article.created_at </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Date</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">( article.comments </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">undefined</span><span style="color: #C9D1D9"> ) article.comments </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> j </span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">;j</span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> article.comments.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9">; j</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        article.comments[j].created_at </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Date</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.db.</span><span style="color: #D2A8FF">save</span><span style="color: #C9D1D9">(articles, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">result</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">( error ) </span><span style="color: #D2A8FF">callback</span><span style="color: #C9D1D9">(error)</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">callback</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, articles);</span></span>
<span class="line"><span style="color: #C9D1D9">    });</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">exports</span><span style="color: #C9D1D9">.ArticleProvider </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> ArticleProvider;</span></span></code></pre>
<p>I added the following view and route to my app.js too, to allow support for clicking upon articles.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #7EE787">div</span><span style="color: #79C0FF">.article</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">h1</span><span style="color: #79C0FF">=</span><span style="color: #C9D1D9"> article.title</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.created_at=</span><span style="color: #C9D1D9"> article.created_at</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.body=</span><span style="color: #C9D1D9"> article.body</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'/blog/view/:id'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">,</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">   articleProvider.</span><span style="color: #D2A8FF">findById</span><span style="color: #C9D1D9">(req.params.id,</span></span>
<span class="line"><span style="color: #C9D1D9">     </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">doc</span><span style="color: #C9D1D9">){</span></span>
<span class="line"><span style="color: #C9D1D9">       res.</span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'blog_view'</span><span style="color: #C9D1D9">, {</span></span>
<span class="line"><span style="color: #C9D1D9">       locals: {</span></span>
<span class="line"><span style="color: #C9D1D9">         title: </span><span style="color: #A5D6FF">'New Post'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">         article: doc</span></span>
<span class="line"><span style="color: #C9D1D9">       }</span></span>
<span class="line"><span style="color: #C9D1D9">     });</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>And in order to support it, the main view now becomes as follows:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #7EE787">h1</span><span style="color: #79C0FF">=</span><span style="color: #C9D1D9"> title</span></span>
<span class="line"><span style="color: #79C0FF">#articles</span></span>
<span class="line"><span style="color: #C9D1D9">  - each article </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> articles</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.article</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.created_at=</span><span style="color: #C9D1D9"> article.created_at</span></span>
<span class="line"><span style="color: #C9D1D9">      - </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> articlelink </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'blog/view/'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> article._id;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">a</span><span style="color: #79C0FF">(href</span><span style="color: #C9D1D9">=articlelink</span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.title=</span><span style="color: #C9D1D9"> article.title</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #7EE787">div</span><span style="color: #79C0FF">.body=</span><span style="color: #C9D1D9"> article.body</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #7EE787">a</span><span style="color: #79C0FF">(href</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">'blog/new'</span><span style="color: #79C0FF">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #7EE787">Add</span><span style="color: #C9D1D9"> new post</span></span></code></pre>
<p>Anyway, so far Iâ€™ve not yet added comment support, but given the headway I made here, Iâ€™d imagine it would be extremely easy to integrate into my couchdb article model. Iâ€™ll update here if I ever get round to adding it!</p>
		</div>
	</article>
	
</section>
	</main><footer class="border-t border-gray-200 dark:border-slate-800">
	<div class="max-w-6xl mx-auto px-4 sm:px-6">
		<div class="md:flex md:items-center md:justify-between py-6 md:py-8">
			<ul class="flex mb-4 md:order-1 -ml-2 md:ml-4 md:mb-0">
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Twitter" href="https://twitter.com/iwootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-twitter"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84 0 0 0 .497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="YouTube" href="https://youtube.com/IanWootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-youtube"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><rect width="18" height="14" x="3" y="5" rx="4"/><path d="m10 9 5 3-5 3z"/></g></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Github" href="https://github.com/iwootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-github"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="LinkedIn" href="https://linkedin.com/in/iwootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><rect width="16" height="16" x="4" y="4" rx="2"/><path d="M8 11v5M8 8v.01M12 16v-5M16 16v-3a2 2 0 0 0-4 0"/></g></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS" href="/rss.xml">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:rss"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"/></g></svg>
					</a>
				</li>
			</ul>
			<div class="text-sm text-gray-700 mr-4 dark:text-slate-400">
				&copy; 2003-2023 Ian Wootten
			</div>
		</div>
	</div>
</footer>
		<script>
	// Set "light" theme as default
	// if (!localStorage.theme) {
	//   localStorage.theme = "light";
	// }

	if (
		localStorage.theme === 'dark' ||
		(!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
	) {
		document.documentElement.classList.add('dark');
	} else {
		document.documentElement.classList.remove('dark');
	}

	function attachEvent(selector, event, fn) {
		const matches = document.querySelectorAll(selector);
		if (matches && matches.length) {
			matches.forEach((elem) => {
				elem.addEventListener(event, () => fn(elem), false);
			});
		}
	}

	window.onload = function () {
		attachEvent('[data-aw-toggle-menu]', 'click', function (elem) {
			elem.classList.toggle('expanded');
			document.body.classList.toggle('overflow-hidden');
			document.getElementById('menu')?.classList.toggle('hidden');
		});

		attachEvent('[data-aw-toggle-color-scheme]', 'click', function () {
			document.documentElement.classList.toggle('dark');
			localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
		});
	};
	window.onpageshow = function () {
		const elem = document.querySelector('[data-aw-toggle-menu]');
		if (elem) {
			elem.classList.remove('expanded');
		}
		document.body.classList.remove('overflow-hidden');
		document.getElementById('menu')?.classList.add('hidden');
	};
</script>

		
	</body>
</html>