<!DOCTYPE html>
<html lang="en" class="motion-safe:scroll-smooth 2xl:text-[20px]">
	<head>
		<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>User Generated Forms with WTForms â€” Ian Wootten</title>
<meta name="robots" content="index,follow" />
<meta property="og:title" content="User Generated Forms with WTForms" />
<meta property="og:url" content="https://www.ianwootten.co.uk/2017/04/18/user-generated-forms-with-wtforms/" />
<meta property="og:type" content="article" />
<link rel="canonical" href="https://www.ianwootten.co.uk/2017/04/18/user-generated-forms-with-wtforms/" />


<!-- Or Google Fonts -->

<meta name="google-site-verification" content="orcPxI47GSa-cRvY11tUe6iGg2IO_RPvnA1q95iEM3M">



<script async src="https://analytics.niftydigits.com/js/pa-yDUcmgXu6nELf6ykbVIFV.js"></script>



<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="mask-icon" href="/favicon.svg" color="#8D46E7">


	<link rel="stylesheet" href="/assets/_...page_.0987525b.css" />
<link rel="stylesheet" href="/assets/_slug_.9a3e7945.css" />
<link rel="stylesheet" href="/assets/index.a49322ed.css" /><script type="module" src="/hoisted.1b636b1c.js"></script>
<script>!(function(w,p,f,c){c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.7.3 - MIT builder.io */
!function(t,e,n,i,r,o,a,d,s,c,p,l){function u(){l||(l=1,"/"==(a=(o.lib||"/~partytown/")+(o.debug?"debug/":""))[0]&&(s=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(w,1e4),e.addEventListener("pt0",f),r?h(1):n.serviceWorker?n.serviceWorker.register(a+(o.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):w())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.setAttribute("style","display:block;width:0;height:0;border:0;visibility:hidden"),c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.7.3":"sandbox-sw.html?"+Date.now()),e.body.appendChild(c)}function w(t,n){for(f(),t=0;t<s.length;t++)(n=e.createElement("script")).innerHTML=s[t].innerHTML,e.head.appendChild(n);c&&c.parentNode.removeChild(c)}function f(){clearTimeout(d)}o=t.partytown||{},i==t&&(o.forward||[]).map((function(e){p=t,e.split(".").map((function(e,n,i){p=p[i[n]]=n+1<i.length?"push"==i[n+1]?[]:p[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);</script></head>

	<body class="antialiased text-gray-900 dark:text-slate-300 tracking-tight bg-white dark:bg-slate-900">
		<header class="sticky top-0 z-40 flex-none mx-auto w-full bg-white md:bg-white/90 dark:bg-slate-900 dark:md:bg-slate-900/90 md:backdrop-blur-sm border-b dark:border-b-0">
	<div class="py-3 px-3 mx-auto w-full md:flex md:justify-between max-w-6xl md:px-4">
		<div class="flex justify-between">
			<a class="flex items-center" href="/">
				<span class="self-center ml-2 text-2xl font-extrabold text-gray-900 whitespace-nowrap dark:text-white">
	ðŸ’»&nbsp;&nbsp;Ian Wootten</span>
			</a>
			<div class="flex items-center md:hidden">
				<button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme>
	<svg viewBox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg>
</button>
				<button type="button" class="ml-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center transition" aria-label="Toggle Menu" data-aw-toggle-menu>
	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" class="w-6 h-6" astro-icon="tabler:menu"><g class="icon-tabler" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8h16"/><path d="M4 16h16"/></g></svg>
</button>
			</div>
		</div>
		<nav class="items-center w-full md:w-auto hidden md:flex text-gray-600 dark:text-slate-200 h-screen md:h-auto" aria-label="Main navigation" id="menu">
			<ul class="flex flex-col pt-8 md:pt-0 md:flex-row md:self-center w-full md:w-auto collapsed text-xl md:text-base">
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="/blog/">Blog</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="/about/">About</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="/work-with-me/">Work With Me</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://niftydigits.gumroad.com/">Products
					</a>
				</li>
				<li>
					<a class="font-medium hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://newsletter.ianwootten.co.uk">Newsletter
					</a>
				</li>
				<li class="md:hidden">
					<a class="font-bold hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://www.youtube.com/IanWootten?sub_confirmation=1">YouTube
					</a>
				</li>
				<li class="md:hidden">
					<a class="font-bold hover:text-gray-900 dark:hover:text-white px-4 py-3 flex items-center transition duration-150 ease-in-out" href="https://github.com/iwootten">Github
					</a>
				</li>
			</ul>
			<div class="md:self-center flex items-center mb-4 md:mb-0 ml-2">
				<div class="hidden items-center md:flex">
					<button type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme>
	<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg>
</button>
					<a href="https://www.youtube.com/IanWootten?sub_confirmation=1" class="inline-block text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5" aria-label="Ian's YouTube Channel">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-youtube"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><rect width="18" height="14" x="3" y="5" rx="4"/><path d="m10 9 5 3-5 3z"/></g></svg>
					</a>
					<a href="https://github.com/iwootten" class="inline-block text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5" aria-label="Ian's Github">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-github"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
					</a>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS Feed" href="/rss.xml">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:rss"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"/></g></svg>
					</a>
				</div>
			</div>
		</nav>
	</div>
</header><main>
		<section class="py-8 sm:py-16 lg:py-20 mx-auto">
	<article>
		<header>
			<p class="max-w-3xl mx-auto text-center">
				<time datetime="2017-04-18T00:00:00.000Z">Apr 18, 2017</time> ~ 6 min read
			</p>
			<h1 class="px-4 sm:px-6 max-w-3xl mx-auto text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-8 font-heading">
				User Generated Forms with WTForms
			</h1>
			<div class="container text-center mx-auto px-8 sm:px-6 max-w-3xl mt-8">
				<ul class="text-sm">
			<li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/python/">python</a>
				</li><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 mb-2 py-0.5 px-2">
					<a href="/tags/wtforms/">wtforms</a>
				</li>
		</ul>
			</div>
			
		</header>
		<div class="container mx-auto px-6 sm:px-6 max-w-3xl prose prose-lg lg:prose-xl dark:prose-invert dark:prose-headings:text-slate-300 prose-md prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-primary-600 dark:prose-a:text-primary-400 prose-img:rounded-md prose-img:shadow-lg mt-8">
			<p>As part of my past work with the Office for National Statistics (ONS), I worked with the survey runner team to add additional features to their Electronic Questionnaire which enabled the business to take regular surveys electronically via the web. During my final months there, I took it upon myself to tackle what was seen to be one of the projects major pieces of technical debt, its use of a custom form renderer. This was identified early on as a feature that shared a lot in common with existing form libraries, but our current renderer wasnâ€™t able to be easily isolated from the rest of the system and was therefore pushed onto a debt backlog after a possible approach had been prototyped.</p>
<p>Due to the hard work of the entire team, weâ€™d made some strategic changes to the system that meant this was possible in my later months. <a href="https://github.com/wtforms/wtforms">WTForms</a> was the library we wanted to use, but we needed a number of features which werenâ€™t documented or supported out of the box. Chief among these was the ability to create forms dynamically, informed by a JSON description.</p>
<h2 id="dynamic-form-definition">Dynamic form definition</h2>
<p>WTForms generally expects metaclasses that describe form definitions, as per the following example from their docs:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">MyForm</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Form</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">  first_name </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> StringField(</span><span style="color: #FF7B72">u</span><span style="color: #A5D6FF">'First Name'</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">validators</span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9">[validators.input_required()])</span></span>
<span class="line"><span style="color: #C9D1D9">  last_name  </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> StringField(</span><span style="color: #FF7B72">u</span><span style="color: #A5D6FF">'Last Name'</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">validators</span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9">[validators.optional()])</span></span></code></pre>
<p>I found it easier to think as these definitions as â€˜schemasâ€™ for form classes. Typically youâ€™d use them to describe a class which doesnâ€™t change, so WTForms use of them for describing our dynamic forms led to some problems.</p>
<p>When the instantiated form is passed to jinja and rendered as part of a template helper call, appropriate inputs will be rendered for each field definition, with names corresponding to the attribute names (first_name, last_name). We can then take the post request form and pass as an argument to our form class to validate during a submission.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(request):</span></span>
<span class="line"><span style="color: #C9D1D9">  form </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> MyForm(request.</span><span style="color: #79C0FF">POST</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> request.method </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'POST'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> form.validate():</span></span>
<span class="line"><span style="color: #C9D1D9">      user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> MyForm()</span></span>
<span class="line"><span style="color: #C9D1D9">      user.first_name </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> form.first_name.data</span></span>
<span class="line"><span style="color: #C9D1D9">      user.last_name </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> form.last_name.data</span></span>
<span class="line"><span style="color: #C9D1D9">      user.save()</span></span>
<span class="line"><span style="color: #C9D1D9">      redirect(</span><span style="color: #A5D6FF">'register'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> render_response(</span><span style="color: #A5D6FF">'register.html'</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">form</span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9">form)</span></span></code></pre>
<p>The approach taken for the ONS was to read in a json description from file and set field attributes dynamically within a method upon what was essentially an empty form class. Iâ€™ve simplified the actual project code below to remove detail outside the example.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">get_answer_fields</span><span style="color: #C9D1D9">(question, data):</span></span>
<span class="line"><span style="color: #C9D1D9">    answer_fields </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {}</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> answer </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> question[</span><span style="color: #A5D6FF">'answers'</span><span style="color: #C9D1D9">]:</span></span>
<span class="line"><span style="color: #C9D1D9">        name </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> answer.get(</span><span style="color: #A5D6FF">'label'</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> question.get(</span><span style="color: #A5D6FF">'title'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">        answer_fields[answer[</span><span style="color: #A5D6FF">'id'</span><span style="color: #C9D1D9">]] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> get_field(answer, name)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> answer_fields</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">generate_form</span><span style="color: #C9D1D9">(json_for_page, data):</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">QuestionnaireForm</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Form</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">        answer_fields </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> question </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> SchemaHelper.get_questions(json_for_page):</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">            answer_fields.update(get_answer_fields(question, data))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> answer_id, field </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> answer_fields.items():</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">setattr</span><span style="color: #C9D1D9">(QuestionnaireForm, answer_id, field)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> data:</span></span>
<span class="line"><span style="color: #C9D1D9">            form </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> QuestionnaireForm(MultiDict(data))</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">            form </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> QuestionnaireForm()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> form</span></span></code></pre>
<p>Here you see that we retrieve details of the json structure for a survey page, and maintain a map of answer fields to be set on the class. The answer ids within the page structure will always be unique and is used as the key for the mapping to each field type. In this way, the resultant form is a collection of fields able to be driven dynamically from our json description.</p>
<h2 id="validating-dynamic-forms">Validating Dynamic Forms</h2>
<p>As well as the fields on our forms being customisable, the validators used upon them were too. This meant for instance, that some fields were optional or required and the messages used for validation needed to be informed by the surveyâ€™s json description.</p>
<p>Below you can see an example of the message for a DateRequired validator being updated based on the message from the schema. You can also see an example of modifying the behaviour of the validator, based on whether or not the date validator includes a day attribute as part of the data sent. This allows for the same validator to be used for different form representations of dates.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">DateRequired</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">object</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">     </span><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">__init__</span><span style="color: #C9D1D9">(self, message</span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">None</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">         </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> message:</span></span>
<span class="line"><span style="color: #C9D1D9">             message </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> error_messages[</span><span style="color: #A5D6FF">'MANDATORY'</span><span style="color: #C9D1D9">]</span></span>
<span class="line"><span style="color: #C9D1D9">         </span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.message </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> message</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">     </span><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">__call__</span><span style="color: #C9D1D9">(self, form, field):</span></span>
<span class="line"><span style="color: #C9D1D9">         </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">hasattr</span><span style="color: #C9D1D9">(form, </span><span style="color: #A5D6FF">'day'</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">             </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> form.day.data </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> form.month.data </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> form.year.data:</span></span>
<span class="line"><span style="color: #C9D1D9">                 </span><span style="color: #FF7B72">raise</span><span style="color: #C9D1D9"> validators.StopValidation(</span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.message)</span></span>
<span class="line"><span style="color: #C9D1D9">         </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">             </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> form.month.data </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> form.year.data:</span></span>
<span class="line"><span style="color: #C9D1D9">                 </span><span style="color: #FF7B72">raise</span><span style="color: #C9D1D9"> validators.StopValidation(</span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.message)</span></span></code></pre>
<p>In more complex situations, it was necessary to pass custom data to our validators to later check against. You can see below, when validating custom date ranges, we pass the â€˜toâ€™ date and initialise the validator with it, before the call to the validator is made with the form (in this case a subform for just a date).</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">DateRangeCheck</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">object</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">__init__</span><span style="color: #C9D1D9">(self, to_field_data</span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">None</span><span style="color: #C9D1D9">, messages</span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">None</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.to_field_data </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> to_field_data</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> messages:</span></span>
<span class="line"><span style="color: #C9D1D9">            messages </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> error_messages</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.messages </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> messages</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">__call__</span><span style="color: #C9D1D9">(self, form, from_field):</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> form.day </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> form.month </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> form.year </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.to_field_data:</span></span>
<span class="line"><span style="color: #C9D1D9">            to_date_str </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"</span><span style="color: #79C0FF">{</span><span style="color: #FF7B72">:02d</span><span style="color: #79C0FF">}</span><span style="color: #A5D6FF">/</span><span style="color: #79C0FF">{</span><span style="color: #FF7B72">:02d</span><span style="color: #79C0FF">}</span><span style="color: #A5D6FF">/</span><span style="color: #79C0FF">{}</span><span style="color: #A5D6FF">"</span><span style="color: #C9D1D9">.format(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.to_field_data[</span><span style="color: #A5D6FF">'day'</span><span style="color: #C9D1D9">] </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.to_field_data[</span><span style="color: #A5D6FF">'month'</span><span style="color: #C9D1D9">] </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">                                                    </span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.to_field_data[</span><span style="color: #A5D6FF">'year'</span><span style="color: #C9D1D9">] </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">''</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">            from_date_str </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"</span><span style="color: #79C0FF">{</span><span style="color: #FF7B72">:02d</span><span style="color: #79C0FF">}</span><span style="color: #A5D6FF">/</span><span style="color: #79C0FF">{</span><span style="color: #FF7B72">:02d</span><span style="color: #79C0FF">}</span><span style="color: #A5D6FF">/</span><span style="color: #79C0FF">{}</span><span style="color: #A5D6FF">"</span><span style="color: #C9D1D9">.format(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">(form.day.data </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">(form.month.data </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">                                                      form.year.data </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">''</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">            from_date </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> datetime.strptime(from_date_str, </span><span style="color: #A5D6FF">"</span><span style="color: #79C0FF">%d</span><span style="color: #A5D6FF">/%m/%Y"</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">            to_date </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> datetime.strptime(to_date_str, </span><span style="color: #A5D6FF">"</span><span style="color: #79C0FF">%d</span><span style="color: #A5D6FF">/%m/%Y"</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">            date_diff </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> to_date </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> from_date</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> date_diff.total_seconds() </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">raise</span><span style="color: #C9D1D9"> validators.ValidationError(</span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.messages[</span><span style="color: #A5D6FF">'INVALID_DATE_RANGE_TO_FROM_SAME'</span><span style="color: #C9D1D9">])</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">elif</span><span style="color: #C9D1D9"> date_diff.total_seconds() </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">raise</span><span style="color: #C9D1D9"> validators.ValidationError(</span><span style="color: #79C0FF">self</span><span style="color: #C9D1D9">.messages[</span><span style="color: #A5D6FF">'INVALID_DATE_RANGE_TO_BEFORE_FROM'</span><span style="color: #C9D1D9">])</span></span></code></pre>
<p>We actually found it necessary to go one step further in that we needed to halt validation for forms in surveys which were considered optional. The solution was an OptionalForm, allowing empty forms to be considered valid if they had no content.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">OptionalForm</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">object</span><span style="color: #C9D1D9">):</span></span>
<span class="line"><span style="color: #C9D1D9">     </span><span style="color: #A5D6FF">"""</span></span>
<span class="line"><span style="color: #A5D6FF">     Allows completely empty form and stops the validation chain from continuing.</span></span>
<span class="line"><span style="color: #A5D6FF">     Will not stop the validation chain if any one of the fields is populated.</span></span>
<span class="line"><span style="color: #A5D6FF">     """</span></span>
<span class="line"><span style="color: #C9D1D9">     field_flags </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #A5D6FF">'optional'</span><span style="color: #C9D1D9">,)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">     </span><span style="color: #FF7B72">def</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">__call__</span><span style="color: #C9D1D9">(self, form, field):</span></span>
<span class="line"><span style="color: #C9D1D9">         empty_form </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">         </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> formfield </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> form:</span></span>
<span class="line"><span style="color: #C9D1D9">             has_raw_data </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">hasattr</span><span style="color: #C9D1D9">(formfield, </span><span style="color: #A5D6FF">'raw_data'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">             is_empty </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> has_raw_data </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">len</span><span style="color: #C9D1D9">(formfield.raw_data) </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span></span>
<span class="line"><span style="color: #C9D1D9">             is_blank </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> has_raw_data </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">len</span><span style="color: #C9D1D9">(formfield.raw_data) </span><span style="color: #FF7B72">>=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9"> \</span></span>
<span class="line"><span style="color: #C9D1D9">                 </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">isinstance</span><span style="color: #C9D1D9">(formfield.raw_data[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">], string_types) </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> formfield.raw_data[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">             </span><span style="color: #8B949E"># By default we'll receive empty arrays for values not posted, so need to allow empty lists</span></span>
<span class="line"><span style="color: #C9D1D9">             empty_field </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">True</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> is_empty </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> is_blank</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">             empty_form </span><span style="color: #FF7B72">&#x26;=</span><span style="color: #C9D1D9"> empty_field</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">         </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> empty_form:</span></span>
<span class="line"><span style="color: #C9D1D9">             </span><span style="color: #FF7B72">raise</span><span style="color: #C9D1D9"> validators.StopValidation()</span></span></code></pre>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>One of the main pain points with WTForms adoption was the lack of form-level validation supported out of the box. We had for instance a number of custom forms, which fell outside the generic examples above, where it was necessary to override the validate method on the form itself. This added complexity to the form that I felt belonged in a validator, similar to the field level ones WTForms supports defined in separate classes. Adding to option of form validators would be great and cover most of the bases and seems like an <a href="https://github.com/wtforms/wtforms/issues/55">oft-requested feature</a>.</p>
<p>I felt that the use of WTForms really helped create a far more structured approach to form design, creation and validation within our project. Getting to the point where we could isolate and shift it over to a common library was a real achievement.</p>
		</div>
	</article>
	
</section>
	</main><footer class="border-t border-gray-200 dark:border-slate-800">
	<div class="max-w-6xl mx-auto px-4 sm:px-6">
		<div class="md:flex md:items-center md:justify-between py-6 md:py-8">
			<ul class="flex mb-4 md:order-1 -ml-2 md:ml-4 md:mb-0">
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Twitter" href="https://twitter.com/iwootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-twitter"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84 0 0 0 .497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="YouTube" href="https://youtube.com/IanWootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-youtube"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><rect width="18" height="14" x="3" y="5" rx="4"/><path d="m10 9 5 3-5 3z"/></g></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Github" href="https://github.com/iwootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-github"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="LinkedIn" href="https://linkedin.com/in/iwootten">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:brand-linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><rect width="16" height="16" x="4" y="4" rx="2"/><path d="M8 11v5M8 8v.01M12 16v-5M16 16v-3a2 2 0 0 0-4 0"/></g></svg>
					</a>
				</li>
				<li>
					<a class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS" href="/rss.xml">
						<svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:rss"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"/></g></svg>
					</a>
				</li>
			</ul>
			<div class="text-sm text-gray-700 mr-4 dark:text-slate-400">
				&copy; 2003-2026 Ian Wootten
			</div>
		</div>
	</div>
</footer>
		<script>
	// Set "light" theme as default
	// if (!localStorage.theme) {
	//   localStorage.theme = "light";
	// }

	if (
		localStorage.theme === 'dark' ||
		(!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
	) {
		document.documentElement.classList.add('dark');
	} else {
		document.documentElement.classList.remove('dark');
	}

	function attachEvent(selector, event, fn) {
		const matches = document.querySelectorAll(selector);
		if (matches && matches.length) {
			matches.forEach((elem) => {
				elem.addEventListener(event, () => fn(elem), false);
			});
		}
	}

	window.onload = function () {
		attachEvent('[data-aw-toggle-menu]', 'click', function (elem) {
			elem.classList.toggle('expanded');
			document.body.classList.toggle('overflow-hidden');
			document.getElementById('menu')?.classList.toggle('hidden');
		});

		attachEvent('[data-aw-toggle-color-scheme]', 'click', function () {
			document.documentElement.classList.toggle('dark');
			localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
		});
	};
	window.onpageshow = function () {
		const elem = document.querySelector('[data-aw-toggle-menu]');
		if (elem) {
			elem.classList.remove('expanded');
		}
		document.body.classList.remove('overflow-hidden');
		document.getElementById('menu')?.classList.add('hidden');
	};
</script>

		
	</body>
</html>