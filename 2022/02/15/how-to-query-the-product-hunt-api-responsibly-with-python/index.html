<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.83.0" />

    
    
    

<title>How to Query the Product Hunt API Responsibly with Python - Ian Wootten</title>
<script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/www.ianwootten.co.uk"
    },
    "articleSection" : "posts",
    "name" : "How to Query the Product Hunt API Responsibly with Python",
    "headline" : "How to Query the Product Hunt API Responsibly with Python",
    "description" : "I recently wrote an article that got to the #1 spot on Hacker News for the folks at ScrapingBee. It focused on retrieving details for the 90,000\u002b featured products from the Product Hunt API and digging into interesting facets of the data. I was excited to see it sat at the #1 for a few hours and the frontpage for longer whilst I repeatedly took screenshots to regale my children with in later life.",
    "inLanguage" : "en-US",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2022",
    "datePublished": "2022-02-15 11:28:10 \u002b0000 UTC",
    "dateModified" : "2022-02-15 11:28:10 \u002b0000 UTC",
    "url" : "https:\/\/www.ianwootten.co.uk\/2022\/02\/15\/how-to-query-the-product-hunt-api-responsibly-with-python\/",
    "wordCount" : "1238",
    "keywords" : [ "python","product hunt","data analysis","client work","Blog" ]
}
</script>
<meta name="description" content="I recently wrote an article that got to the #1 spot on Hacker News for the folks at ScrapingBee. It focused on retrieving details for the 90,000&#43; featured products from the Product Hunt API and digging into interesting facets of the data. I was excited to see it sat at the #1 for a few hours and the frontpage for longer whilst I repeatedly took screenshots to regale my children with in later life.">
<meta name="keywords" content="Developer, Programming, Python, Terraform, Serverless, VueJS, Cardiff">
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.ianwootten.co.uk/images/how-to-query-product-hunt-api/opengraph.jpg"/>

<meta name="twitter:title" content="How to Query the Product Hunt API Responsibly with Python"/>
<meta name="twitter:description" content="I recently wrote an article that got to the #1 spot on Hacker News for the folks at ScrapingBee. It focused on retrieving details for the 90,000&#43; featured products from the Product Hunt API and digging into interesting facets of the data. I was excited to see it sat at the #1 for a few hours and the frontpage for longer whilst I repeatedly took screenshots to regale my children with in later life."/>

<meta property="og:title" content="How to Query the Product Hunt API Responsibly with Python" />
<meta property="og:description" content="I recently wrote an article that got to the #1 spot on Hacker News for the folks at ScrapingBee. It focused on retrieving details for the 90,000&#43; featured products from the Product Hunt API and digging into interesting facets of the data. I was excited to see it sat at the #1 for a few hours and the frontpage for longer whilst I repeatedly took screenshots to regale my children with in later life." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ianwootten.co.uk/2022/02/15/how-to-query-the-product-hunt-api-responsibly-with-python/" /><meta property="og:image" content="https://www.ianwootten.co.uk/images/how-to-query-product-hunt-api/opengraph.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-15T11:28:10&#43;00:00" />
<meta property="article:modified_time" content="2022-02-15T11:28:10&#43;00:00" />



    


<link rel="stylesheet" href="https://www.ianwootten.co.uk/css/hyde-hyde.css">
<link rel="stylesheet" href="https://www.ianwootten.co.uk/css/print.css" media="print">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.ianwootten.co.uk/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="https://www.ianwootten.co.uk/favicon.png">
    

    <script async defer data-domain="ianwootten.co.uk" src="https://analytics.niftydigits.com/js/plausible.js"></script>
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.ianwootten.co.uk">Ian Wootten</a>
      </span>
      
      
      
      <div class="author-image">
        <a href="https://www.ianwootten.co.uk"><img src="https://www.ianwootten.co.uk/images/headshot.jpg" alt="Author Image" class="img--circle img--headshot element--center" width="115px" height="115px"></a>
      </div>
      
      <p class="site__description">
         Software Developer, Cardiff 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Ian Wootten</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="https://www.ianwootten.co.uk/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://www.ianwootten.co.uk/hire-me/">
						<span>Hire Me</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://www.getrevue.co/profile/iwootten">
						<span>Subscribe</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/iwootten" rel="me"><i alt="My Twitter profile" class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://youtube.com/channel/UCIrmOddTgfsohRAHrJ5ltrA" rel="me"><i alt="My youtube channel" class="fab fa-youtube fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/iwootten" rel="me"><i alt="My Github profile" class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/iwootten" rel="me"><i alt="My linkedin profile" class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/1405701" rel="me"><i alt="My stackoverflow profile" class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy;2003-2022 Ian Wootten
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1><a href="https://www.ianwootten.co.uk/2022/02/15/how-to-query-the-product-hunt-api-responsibly-with-python/">How to Query the Product Hunt API Responsibly with Python</a></h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 15, 2022
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="https://www.ianwootten.co.uk/categories/development">DEVELOPMENT</a>
              â€¢
          
              <a class="badge badge-category" href="https://www.ianwootten.co.uk/categories/tutorial">TUTORIAL</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/python">python</a>
           
      
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/product-hunt">product hunt</a>
           
      
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/data-analysis">data analysis</a>
           
      
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/client-work">client work</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  <div class="post">
    <p>I recently <a href="https://www.scrapingbee.com/blog/best-python-http-clients/">wrote an article</a> that got to the #1 spot on Hacker News for the folks at ScrapingBee. It focused on retrieving details for the 90,000+ featured products from the Product Hunt API and digging into interesting facets of the data.  I was excited to see it sat at the #1 for a few hours and the frontpage for longer whilst I repeatedly took screenshots to regale my children with in later life. I&rsquo;ve even discovered that some students are considering pursuing a masters into topic around the dataset after seeing the article.</p>
<p>Here, I&rsquo;m going to go into detail on how to retrieve information responsibly from the Product Hunt API for your own data experiments. To do so, I used the <code>x-rate-limit-remaining</code> and <code>x-rate-limit-reset</code> header values that are returned each time a query is made. These values have been given so as to not overwhelm the Product Hunt API servers when querying a large collection of data and you won&rsquo;t get a response if you exceed them. It&rsquo;s therefore important to factor them into any script you write to query data and be a responsible API citizen.</p>
<h1 id="making-a-single-query">Making a Single Query</h1>
<p>To get set up, you&rsquo;ll need an API key - which you&rsquo;ll get when making a request for your first application from the <a href="https://www.producthunt.com/v2/oauth/applications">API dashboard</a>.</p>
<p>Product Hunt has two versions of their API, one uses REST (deprecated) and one uses GraphQL. The GraphQL one, whilst much more versatile (eg. will allow complex filtering), will return far less data on each call (up to 20 products vs 50) and you&rsquo;ll hit your limits much quicker. You&rsquo;ll also be able to make less requests based on how much data you want to return. I calculated that getting all 90,000 products with all the additional data we wanted would take several days (!) using the GraphQL API and I&rsquo;d prefer not to be waiting that long.</p>
<p>For the original article, I used V1 of the API and I&rsquo;ll be doing the same thing here. Additionally, I&rsquo;m using <a href="https://www.python-httpx.org/">HTTPX</a> as the library to make my queries, but you can use any library you like.</p>
<p>Firstly, let&rsquo;s kick off with a simple query to get the most recent posts and header information we&rsquo;re interested in. We need to ensure we pass an Authorization token to authenticate and I extract some of the header details to use later.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> httpx
<span style="color:#f92672">import</span> os

PRODUCTHUNT_API_TOKEN <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;PRODUCTHUNT_API_TOKEN&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_posts</span>():
    headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Authorization&#34;</span>: f<span style="color:#e6db74">&#34;Bearer {PRODUCTHUNT_API_TOKEN}&#34;</span>}

    <span style="color:#66d9ef">with</span> httpx<span style="color:#f92672">.</span>Client(headers<span style="color:#f92672">=</span>headers) <span style="color:#66d9ef">as</span> client:
        r <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>get(
            <span style="color:#e6db74">&#34;https://api.producthunt.com/v1/posts/all&#34;</span>,
            params<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;per_page&#34;</span>: <span style="color:#ae81ff">50</span>},
            timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>,
        )
        limits <span style="color:#f92672">=</span> {h: v <span style="color:#66d9ef">for</span> h, v <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>headers<span style="color:#f92672">.</span>items() <span style="color:#66d9ef">if</span> h<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;x-rate-limit&#34;</span>)}

        <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;posts&#34;</span>], limits

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    posts, limits <span style="color:#f92672">=</span> get_posts()
    <span style="color:#66d9ef">print</span>(limits)
</code></pre></div><p>If this is the first request you&rsquo;ve made, the header values that are printed out to the command line should be as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;x-rate-limit-limit&#39;</span>: <span style="color:#e6db74">&#39;250&#39;</span>, <span style="color:#e6db74">&#39;x-rate-limit-remaining&#39;</span>: <span style="color:#e6db74">&#39;250&#39;</span>, <span style="color:#e6db74">&#39;x-rate-limit-reset&#39;</span>: <span style="color:#e6db74">&#39;900&#39;</span><span style="color:#f92672">}</span>
</code></pre></div><p>We can see our limits are currently at their maximum value as we might expect. The <code>x-rate-limit-remaining</code> value is the remaining time in seconds before the rate limit resets. A subsequent should look like the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">{</span><span style="color:#e6db74">&#39;x-rate-limit-limit&#39;</span>: <span style="color:#e6db74">&#39;250&#39;</span>, <span style="color:#e6db74">&#39;x-rate-limit-remaining&#39;</span>: <span style="color:#e6db74">&#39;249&#39;</span>, <span style="color:#e6db74">&#39;x-rate-limit-reset&#39;</span>: <span style="color:#e6db74">&#39;273&#39;</span><span style="color:#f92672">}</span>
</code></pre></div><p>You can see some of our values have now reduced - we&rsquo;ve decremented our remaining limit by 1 and can see we have 4 and a half minutes to wait before that rate resets. The reset time is a fixed point in time based on when our first request was made, which resets every 15 minutes. Therefore if we made a single request, disappeared for 5 mins, returned and made another the value would be the same as if we&rsquo;d made a whole number of requests in succession. You can see in my own two examples, it took me a full 10 minutes before executing the second one. The limits on the V2 API are higher, but will reduce much more quickly too and even more so if you request a more complex payload.</p>
<h1 id="making-multiple-queries">Making Multiple Queries</h1>
<p>If we were just to start pulling posts from the API as quickly as possible in a loop, we&rsquo;d very quickly hit our limit and start returning empty data. There isn&rsquo;t much use in making requests that return nothing, especially if we desire to leave our machine unattended whilst making them.</p>
<p>Instead, lets code a loop that takes the limit values we&rsquo;re returned into consideration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> httpx
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> json
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime

PRODUCTHUNT_API_TOKEN <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;PRODUCTHUNT_API_TOKEN&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_posts_loop</span>():
    more_data <span style="color:#f92672">=</span> True
    params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;per_page&#34;</span>: <span style="color:#ae81ff">50</span>}
    page_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
    headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Authorization&#34;</span>: f<span style="color:#e6db74">&#34;Bearer {PRODUCTHUNT_API_TOKEN}&#34;</span>}

    <span style="color:#66d9ef">with</span> httpx<span style="color:#f92672">.</span>Client(headers<span style="color:#f92672">=</span>headers) <span style="color:#66d9ef">as</span> client:
        <span style="color:#66d9ef">while</span> more_data:
            r <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>get(
                <span style="color:#e6db74">&#34;https://api.producthunt.com/v1/posts/all&#34;</span>, params<span style="color:#f92672">=</span>params, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
            )
            data <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>json()
            limits <span style="color:#f92672">=</span> {
                h: v <span style="color:#66d9ef">for</span> h, v <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>headers<span style="color:#f92672">.</span>items() <span style="color:#66d9ef">if</span> h<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;x-rate-limit&#34;</span>)
            }

            <span style="color:#75715e"># Do something exciting with the data (more so than write it to a file)</span>
            <span style="color:#66d9ef">with</span> open(f<span style="color:#e6db74">&#34;{datetime.now()}.json&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>) <span style="color:#66d9ef">as</span> f:
                <span style="color:#66d9ef">print</span>(limits)
                json<span style="color:#f92672">.</span>dump(data, f, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)

            <span style="color:#66d9ef">if</span> int(r<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#34;x-rate-limit-remaining&#34;</span>]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
                time_to_sleep <span style="color:#f92672">=</span> int(r<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#34;x-rate-limit-reset&#34;</span>]) <span style="color:#f92672">+</span> <span style="color:#ae81ff">30</span>
                <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;Rate limit exceeded, waiting {time_to_sleep}s...&#34;</span>)
                time<span style="color:#f92672">.</span>sleep(time_to_sleep)
            <span style="color:#66d9ef">else</span>:
                time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)

            more_data <span style="color:#f92672">=</span> (
                <span style="color:#e6db74">&#34;posts&#34;</span> <span style="color:#f92672">in</span> data
                <span style="color:#f92672">and</span> len(data[<span style="color:#e6db74">&#34;posts&#34;</span>])
                <span style="color:#f92672">and</span> params<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;page&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;</span> page_limit
            )

            <span style="color:#66d9ef">if</span> more_data:
                params[<span style="color:#e6db74">&#34;page&#34;</span>] <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;page&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>In the above example you can see we make the request as part of a loop, incrementing and passing the &lsquo;page&rsquo; key to step back through the next page of 50 items for each subsequent request. If our <code>x-rate-limit-remaining</code> value gets to zero, we sleep for the remaining <code>x-rate-limit-reset</code> value (plus a slight pause of 30 seconds) before requesting the next 50 items. By this time our remaining and reset values will have reset allowing us to continue.</p>
<p>If we left the above script running, it will return 100 pages of products from the Product Hunt featured product catalog, writing them to disk before terminating. This gives us details of the most recent 5000 products and we can obviously change our page limit to go back even further.</p>
<p>Even within the default loop behaviour, I&rsquo;ve added a sleep of 2 seconds between each request. It is unnecessary make all our requests at as soon as possible, as we&rsquo;re limited anyway so we might as well keep a slow and steady pace throughout. The code would also work the same for V2 of the API, though we would need to change the remaining comparison with zero to a higher value.</p>
<h1 id="closing-thoughts">Closing Thoughts</h1>
<p>The Product Hunt API provides access to a really interesting dataset which can be interpreted in a multitude of ways. When querying it and any API for large amounts of data however we need to be mindful of adhering to the limits that have been put in place by the API owners and behaving responsibly when making queries.</p>
<p>I had a lot of fun interpreting this data and thoroughly enjoyed working with it. I&rsquo;ve been given a whole bunch of ideas for other ways the Product Hunt data could be interpreted since the article being posted and will likely do so as part of a future article here.</p>
<p>I will also say I&rsquo;d love to do more paid &lsquo;data analysis&rsquo; technical writing like this. If you have an interesting dataset and like my work, please get in touch and lets make it happen.</p>
<form action="https://www.getrevue.co/profile/iwootten/add_subscriber" method="post" id="revue-form" name="revue-form"
  target="_blank" style="background: #e7daf1; padding: 1rem; margin-top: 2rem; border: 2px solid #300030;">
  <h4 style="margin-top:0">Get Regular Tips to Your Inbox</h4>
  <p>My <a href="https://www.getrevue.co/profile/iwootten">newsletter</a> comes out every few
    weeks and is stuffed with helpful stories, tools and code showing how developers like yourself ship efficiently. It
    also
    features articles and
    videos I've recently published so you'll never miss out.
  <p>

  <p>No spam, unsubscribe any time. Check out <a href="https://www.getrevue.co/profile/iwootten">previous issues
      here</a>.
  </p>
  <div class="revue-form-group">
    <input class="revue-form-field" placeholder="Your email address..." type="email" name="member[email]"
      id="member_email" style="width: 100%;font-size: 20px;">
  </div>
  <div class="revue-form-actions">
    <input type="submit" value="Subscribe" name="member[subscribe]" id="member_submit">
  </div>
</form>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://www.ianwootten.co.uk/2022/01/27/how-to-create-aws-lambda-layers-for-python-dependencies/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">How to Create AWS Lambda Layers for Python Dependencies</span>
    </a>
    
    
    <a href="https://www.ianwootten.co.uk/2022/02/18/how-to-use-env-files-with-poetry/" class="navigation-next">
      <span class="navigation-tittle">How to use .env files with Poetry</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>


    
    




    



    </body>
</html>
