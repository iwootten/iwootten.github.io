<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.83.1" />

    
    
    

<title>How to Create AWS Lambda Layers for Python Dependencies - Ian Wootten</title>
<script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/www.ianwootten.co.uk"
    },
    "articleSection" : "posts",
    "name" : "How to Create AWS Lambda Layers for Python Dependencies",
    "headline" : "How to Create AWS Lambda Layers for Python Dependencies",
    "description" : "Using AWS Lambda for your serverless Python app can give significant cost and management benefits. However, unless your needs are simple you will quickly need to bundle your dependencies along with your functions. Doing so with an AWS Lambda Layer works much like installing dependencies within a local environment. You are able to reduce each functions size, maintain your core code separately and simply tell the function to use the layer when setting it up.",
    "inLanguage" : "en-US",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2022",
    "datePublished": "2022-01-27 11:58:06 \u002b0000 UTC",
    "dateModified" : "2022-01-27 11:58:06 \u002b0000 UTC",
    "url" : "https:\/\/www.ianwootten.co.uk\/2022\/01\/27\/how-to-create-aws-lambda-layers-for-python-dependencies\/",
    "wordCount" : "418",
    "keywords" : [ "python","aws","docker","serverless","Blog" ]
}
</script>
<meta name="description" content="Using AWS Lambda for your serverless Python app can give significant cost and management benefits. However, unless your needs are simple you will quickly need to bundle your dependencies along with your functions. Doing so with an AWS Lambda Layer works much like installing dependencies within a local environment. You are able to reduce each functions size, maintain your core code separately and simply tell the function to use the layer when setting it up.">
<meta name="keywords" content="Developer, Programming, Python, Terraform, Serverless, VueJS, Cardiff">
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.ianwootten.co.uk/images/how-to-create-lambda-layers/opengraph.jpg"/>

<meta name="twitter:title" content="How to Create AWS Lambda Layers for Python Dependencies"/>
<meta name="twitter:description" content="Using AWS Lambda for your serverless Python app can give significant cost and management benefits. However, unless your needs are simple you will quickly need to bundle your dependencies along with your functions. Doing so with an AWS Lambda Layer works much like installing dependencies within a local environment. You are able to reduce each functions size, maintain your core code separately and simply tell the function to use the layer when setting it up."/>

<meta property="og:title" content="How to Create AWS Lambda Layers for Python Dependencies" />
<meta property="og:description" content="Using AWS Lambda for your serverless Python app can give significant cost and management benefits. However, unless your needs are simple you will quickly need to bundle your dependencies along with your functions. Doing so with an AWS Lambda Layer works much like installing dependencies within a local environment. You are able to reduce each functions size, maintain your core code separately and simply tell the function to use the layer when setting it up." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ianwootten.co.uk/2022/01/27/how-to-create-aws-lambda-layers-for-python-dependencies/" /><meta property="og:image" content="https://www.ianwootten.co.uk/images/how-to-create-lambda-layers/opengraph.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-27T11:58:06&#43;00:00" />
<meta property="article:modified_time" content="2022-01-27T11:58:06&#43;00:00" />



    


<link rel="stylesheet" href="https://www.ianwootten.co.uk/css/hyde-hyde.css">
<link rel="stylesheet" href="https://www.ianwootten.co.uk/css/print.css" media="print">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.ianwootten.co.uk/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="https://www.ianwootten.co.uk/favicon.png">
    

    <script async defer data-domain="ianwootten.co.uk" src="https://analytics.niftydigits.com/js/plausible.js"></script>
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.ianwootten.co.uk">Ian Wootten</a>
      </span>
      
      
      
      <div class="author-image">
        <a href="https://www.ianwootten.co.uk"><img src="https://www.ianwootten.co.uk/images/headshot.jpg" alt="Author Image" class="img--circle img--headshot element--center" width="115px" height="115px"></a>
      </div>
      
      <p class="site__description">
         Software Developer, Cardiff 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Ian Wootten</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="https://www.ianwootten.co.uk/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://www.ianwootten.co.uk/contact/">
						<span>Contact</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://www.getrevue.co/profile/iwootten">
						<span>Newsletter</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/iwootten" rel="me"><i alt="My Twitter profile" class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://youtube.com/channel/UCIrmOddTgfsohRAHrJ5ltrA" rel="me"><i alt="My youtube channel" class="fab fa-youtube fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/iwootten" rel="me"><i alt="My Github profile" class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/iwootten" rel="me"><i alt="My linkedin profile" class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/1405701" rel="me"><i alt="My stackoverflow profile" class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy;2003-2022 Ian Wootten
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1><a href="https://www.ianwootten.co.uk/2022/01/27/how-to-create-aws-lambda-layers-for-python-dependencies/">How to Create AWS Lambda Layers for Python Dependencies</a></h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 27, 2022
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="https://www.ianwootten.co.uk/categories/development">DEVELOPMENT</a>
              â€¢
          
              <a class="badge badge-category" href="https://www.ianwootten.co.uk/categories/tutorial">TUTORIAL</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/python">python</a>
           
      
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/aws">aws</a>
           
      
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/docker">docker</a>
           
      
          <a class="badge badge-tag" href="https://www.ianwootten.co.uk/tags/serverless">serverless</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 2 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Using AWS Lambda for your serverless Python app can give significant cost and management benefits. However, unless your needs are simple you will quickly need to bundle your dependencies along with your functions. Doing so with an AWS Lambda Layer works much like installing dependencies within a local environment. You are able to reduce each functions size, maintain your core code separately and simply tell the function to use the layer when setting it up.</p>
<p>Layers are bundled as a zip archive, but you&rsquo;ll be running a different architecture on a dev machine than the Lambda does itself which could present problems for certain packages. Therefore, you need to create your lambda layer within docker.</p>
<p>After trying a few different approaches, I found the <a href="https://gist.github.com/haranjackson/81ab8dc3ae54bbe91c623d7c4f1e4f14">following script</a> by <a href="twitter.com/haranjackson">haranjackson</a> the best solution. It uses a docker image from <a href="https://github.com/lambci/docker-lambda">lambci</a> and the AWS CLI to build and publish a Lambda Layer to AWS. I&rsquo;ve modified this below, and <a href="https://gist.github.com/iwootten/1b3d51acabb07770dca024dc33390905">created a gist</a> which will install from a requirements.txt file within in the same folder.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">REGION<span style="color:#f92672">=</span>eu-west-2
RUNTIME<span style="color:#f92672">=</span>python3.8
LAYER_NAME<span style="color:#f92672">=</span>app

docker run -v <span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span>:/out -it lambci/lambda:build-$RUNTIME <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pip install -r /out/requirements.txt -t /out/build/$LAYER_NAME/python

cd build/$LAYER_NAME
zip -r ../../$LAYER_NAME.zip python/
cd ../..

aws lambda publish-layer-version <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --layer-name $LAYER_NAME <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --zip-file fileb://$LAYER_NAME.zip <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --compatible-runtimes $RUNTIME

rm -rf build *.zip
</code></pre></div><p>You&rsquo;ll then be able to see the Layer under &ldquo;Additional Resources&rdquo; from the AWS Lambda console and make use of it from any of your Lambda functions.</p>
<h3 id="alternative-approaches">Alternative approaches</h3>
<p>This works great for runtimes up to Python 3.8, but later ones are unavailable from the lambci dockerhub images. Amazon have their own <a href="https://hub.docker.com/r/amazon/aws-lambda-python">python lambda images</a>, though I&rsquo;ve not had success using them to build layers using the approach above.</p>
<p>For other projects, I&rsquo;d normally tackle bundling dependencies using something like the <a href="serverless.com">serverless.com</a> framework though I&rsquo;ve grown a bit tired of Python playing a second class citizen to JS - debugging errors quickly becomes difficult.</p>
<p>Another alternative approach could be to use the <a href="https://aws.amazon.com/serverless/sam/">Serverless Application Model</a> (SAM) by Amazon themselves. This is definitely something I want to check out. For now, I decided I wanted to understand what was going on and keep it simple rather than jumping through multiple frameworks.</p>
<form action="https://www.getrevue.co/profile/iwootten/add_subscriber" method="post" id="revue-form" name="revue-form"
  target="_blank" style="background: #e7daf1; padding: 1rem; margin-top: 2rem; border: 2px solid #300030;">
  <h4 style="margin-top:0">Dev Stories to Inspire, Tools to Help You Ship</h4>
  <p>My <a href="https://www.getrevue.co/profile/iwootten">newsletter</a> comes out every few
    weeks and is stuffed with helpful stories, tools and code from devs shipping stuff. It also features articles and
    videos
    I've recently published here so you'll never miss out.
  <p>

  <p>No spam, unsubscribe any time. Check out <a href="https://www.getrevue.co/profile/iwootten">previous issues
      here</a>.
  </p>
  <div class="revue-form-group">
    <input class="revue-form-field" placeholder="Your email address..." type="email" name="member[email]"
      id="member_email" style="width: 100%;font-size: 20px;">
  </div>
  <div class="revue-form-actions">
    <input type="submit" value="Subscribe" name="member[subscribe]" id="member_submit">
  </div>
</form>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://www.ianwootten.co.uk/2022/01/10/rendering-a-christmas-tree-that-never-comes-down-with-p5.js/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Rendering a Christmas Tree that Never Comes Down with p5.js</span>
    </a>
    
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>


    
    




    



    </body>
</html>
